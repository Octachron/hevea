 \documentclass{article}
\usepackage{a4}
\usepackage{fullpage}
\usepackage{texnames}
\usepackage{../hevea}
\usepackage{isolatin1}
\usepackage{epsf}
%HEVEA\usepackage{color}


\renewcommand{\thepart}{\Alph{part}}
\renewcommand{\numberline}[1]{#1\quad}
%%%%%%%%%%%%%%%%%%%%
\newcommand{\commandname}[1]{{\tt #1}}
\newcommand{\filename}[1]{{\em #1}}
\newcommand{\urlex}[1]{\footurl{\docurl/examples/#1}{\texttt{#1}}}
\newcommand{\localurl}[1]{%
%BEGIN LATEX
\footurl{\docurl/doc/#1}{\texttt{#1}}%
%END LATEX
%HEVEA\url{#1}{\docurl/doc/#1}%
}
\begin{latexonly}
\gdef\myrule{\rule{\linewidth}{.05ex}}
\gdef\htmlout{\begingroup\linewidth=.8\linewidth\begin{quote}%
\parskip=0pt\parindent=0pt\myrule\par}
\gdef\endhtmlout{\par\vspace*{-.5\baselineskip}\myrule\end{quote}\endgroup}
\end{latexonly} 
\begin{htmlonly}
\gdef\myrule{\@print{<HR NOSHADE SIZE=1 ALIGN=center>
}}%
\gdef\htmlout{\begin{quote}\myrule}
\gdef\endhtmlout{\myrule\end{quote}}
\end{htmlonly}
\newenvironment{latexout}{\begin{htmlout}}{\end{htmlout}}
\newenvironment{showlatex}{}{}

\input{version.tex}

\title{\hevea{} User Documentation\\
{\normalsize Version~\heveaversion}}
\author{Luc Maranget\thanks{Inria Rocquencourt -- BP 105, 78153 Le
Chesnay Cedex. {\tt \mailto{Luc.Maranget@inria.fr}}}}
\date{}
\begin{document}

\maketitle

\newcommand{\ftpbase}{ftp://ftp.inria.fr/INRIA/Projects/para/hevea}%
\newcommand{\httpbase}{http://para.inria.fr/\home{maranget}/hevea}%
\begin{htmlonly}
\@print{
<HR>
}%
This manual also exists in
\url{\ftpbase/hevea-\heveaversion-manual.ps.gz}{Postscript} and and as
a \url{\ftpbase/hevea-\heveaversion-manual.tar.gz}{bundle of HTML files}.
\@print{
<HR>
}%
\end{htmlonly}

\begin{abstract}
\hevea{} is a \LaTeX{} to
{\html} translator.
The input language is a fairly complete subset of \LaTeXe{} (old
\LaTeX{} style is also accepted) and the
output language is {\html} that is (hopefully) correct with respect to
version 3.2.

Exotic symbols are translated into symbols
pertaining to the symbol font of the {\html} browser, using the
non-standard \verb+FACE+ attribute of the \verb+FONT+ tag.
This allows the translation to {\html} of quite a lot of the symbols used in
\LaTeX.


\hevea{} understands \LaTeX{} macro definitions. Simple user style
files are understood with little or no modifications.
Furthermore, \hevea{} customization is done by writing \LaTeX{} code.


\hevea{} is written in Objective Caml, as many lexers. It is
quite fast and flexible.
Using \hevea{} it is possible to translate  large documents such
as manuals, books, etc. very quickly. All documents are
translated as one single {\html} file. Then, the output file can be cut into
smaller files, using the companion program \hacha.

Information on \hevea{} is available at \oneurl{\docurl}.
\end{abstract}


\clearpage
\tableofcontents

\clearpage
\part{User manual}\label{usermanual}

\section{How to get started}\label{getstarted}

Assume that you have a file, ``\texttt{a.tex}'', written in \LaTeX, using the
\filename{article}, \filename{book} or \filename{report} style. Then,
translation
is achieved by issuing the command~:
\begin{verbatim}
# hevea a.tex
\end{verbatim}
Probably, you will get some warnings. If
\hevea{} does not crash, just ignore them for the moment
(Section~\ref{trouble}  explains how to correct errors).

If everything goes fine, this will produce a new file,
``\texttt{a.html}'', that you can visualize using an {\html} browser.
If \texttt{a.tex} contains math symbols you need to instruct your
browser to use symbol fonts (see section~\ref{browser}).

If you wish to experiment \hevea{} on small \LaTeX{} source fragments,
then launch \hevea{} without arguments. \hevea{} will read its
standard input and print the translation on its standard output.
For instance:
\begin{verbatim}
# hevea
$x \in {\cal E}$
^D
<I>x</I> <FONT FACE=symbol>Î</FONT> <FONT COLOR=red><I>E</I></FONT>
\end{verbatim}

You can find some \footurl{\docurl/examples/}{examples} in the on-line
documentation, including examples of \urlex{a.tex} and
\urlex{a.html} files.

\section{Syle files}
\LaTeX style files are files that are not intended to produce output, but
define document layout parameters, commands, environments, etc.

\subsection{Standard base styles}

The base style of a \LaTeX{} document is the argument to the
\verb+\documentclass+ command (\verb+\documentstyle+ in old style).
Normally, the base style of a document defines the structure and
appearance of the whole document.



\noindent\hevea{} knows about two \LaTeX{} base styles,
\filename{article} and \filename{book}.
Additionally, the \filename{report} base style is recognized and
considered equivalent to \filename{book} and the
\filename{seminar} base style for making slides is recognized and
implemented by small additions on the \filename{article} style.


Base style \filename{style} is implemented by an \hevea{} specific
style file whose name must be \filename{style}\verb+.hva+.
More precisely, \hevea{} interprets
\verb+\documentclass{+\filename{style}\verb+}+ by attempting to load
the file \filename{style}\verb+.hva+ (see section~\ref{heveausage} on where
\hevea{} searches for files).
Thus, at the moment, \hevea{} distribution includes the files,
\texttt{article.hva}, \texttt{book.hva}, etc.


\subsection{Other base styles}
Documents whose base style is not recognized by \hevea{} can be
processed when the unknown base style is a derivation of a
recognized base style.

Let us assume that \texttt{mydoc.tex} uses an exotic
base style such as \filename{acmconf}. Then, typing
\verb+hevea mydoc.tex+ will yield an error, since
\hevea{} cannot find the \texttt{acmconf.hva} file:
\begin{verbatim}
# hevea.opt mydoc.tex
mydoc.tex:1: Warning: Cannot find file: acmconf.hva
mydoc.tex:1: Error while reading LaTeX: No base style
Adios
\end{verbatim}


This situation is avoided by invoking \hevea{} with the known
base style file  \texttt{article.hva} as an extra argument:
\begin{verbatim}
# hevea article.hva mydoc.tex
\end{verbatim}
The extra argument instructs
\hevea{} to load its \texttt{article.hva}
style file before processing \texttt{mydoc.tex}
It will then ignore the document base style specified by
\verb+\documentclass+ (or \verb+\documentstyle+).

Observe that the fix above works because the \filename{acmconf} and
\filename{article} base styles look the same to the document (i.e., they define
the same macros).
More generally, most  base styles that are neither
\textit{article} nor \textit{book} are in fact variations
on either two of them.
However, such styles usually provides extra macros.
If users documents use these macros, then users should also instruct
\hevea{} about them (see section~\ref{dontknow}).

If the document base style departs significantly from \hevea{} base
styles, a specific base style file has to be written.
Although tedious, it remains feasible because \hevea{} source langage
is \LaTeX, but this probably requires some understanding of
\hevea{} internals. Reading the base style files \texttt{article.hva} and
\texttt{seminar.hva} from the distribution will give clues on how to
proceed.

Finally, it is important to notice that
renaming a base style file \filename{style}\verb+.cls+ into
\filename{style}\verb+.hva+ will not work in general.
As a matter of fact, base style files are \TeX{} and not \LaTeX{} source and
\hevea{} will almost surely fail on \TeX-ish input.


\subsection{Other style files}

A \LaTeX{} document usually loads additional style files (using
\verb+\input+ or \verb+\usepackage+, or by giving optional arguments to \verb+\documentstyle+).
\hevea{} simply ignores \verb+\usepackage+ and optional arguments to
\verb+\documentstyle+, but it attempts to load a file given as argument
to \verb+\input+.
(You can see what files \hevea{} loads or attempts to load by using
the \verb+-v+ option.)

A simple situation is when \hevea{} is not happy  with just a few macros
in a style file.
As it is often the case, assume that the document \texttt{mydoc.tex} has a
\verb+\input{macros.tex}+ instruction in its preamble, where
\texttt{macros.tex} gathers custom definitions.
Hopefully, only a few macros give rise to trouble: macros that performs fine
typesetting or {\TeX}ish macros.
Such macros need to be rewritten, using basic \LaTeX{}
constructs (section~\ref{trouble} gives examples of macro-rewriting).
The new definitions are best collected in a style file,
\texttt{macros.hva} for instance.
Then, \texttt{mydoc.tex} is to be translated by issuing the command:
\begin{verbatim}
# hevea macros.hva mydoc.tex
\end{verbatim}
The file \texttt{macros.hva} is processed before
\texttt{mydoc.tex} (and thus before \texttt{macros.tex}).
As a consequence, the macro definitions in \texttt{mymacros.tex}
override the ones in  \texttt{macros.tex}, since the latter are made
using \verb+\newcommand+ or \verb+\def+ (section~\ref{usermacro}
explains how \hevea{} handle macro definitions and redefinitions).

Another situation is when  \hevea{} fails to process a whole 
style file. Usually, this means that \hevea{} crashes on that style
file.
Then, you should also instruct
\hevea{} not to load the faulty file, by issuing the command:
\begin{verbatim}
# hevea macros.hva -e macros.tex mydoc.tex
\end{verbatim}
Of course, \texttt{macros.hva} must now contain replacements for
all the useful macros of \texttt{macro.tex}.
Note that another solution to instruct \LaTeX{} to load a file and
\hevea{} not to load it is to use \verb+\usepackage+ or optional
arguments to \verb+\documentstyle+, which \hevea{}
ignores.


\section{A note on style}

\subsection{Spacing, Paragraphs}
Spacing in the \html{} document reflects the original source spacing.
More precisely, any non empty sequence of spaces is outputed as one
space, whereas a single newline is replicated in the output.
However one  blank line  (i.e., two newlines in a row) or more
introduce a paragraph break.
Paragraphs are rendered by a blank line and there is no paragraph
indentation.
\hevea{} is a bit simplistic in breaking paragraphs and extra paragraph
breaks may be present in the final \html{} documents.
This can usually be corrected by modifying the source, without
altering \LaTeX{} output. For instance, some blank line before or
after a comment or macro definition can be deleted.




Space after macros with no argument is skipped (as in \LaTeX{}) ---
however this is not true in math mode, as explained in
section~\ref{spacemath} below.
Consider the following example:
\begin{verbatim}
\newcommand{\open}{(}
\newcommand{\close}{)}
\open text opened by ``open''
and closed by ``close''\close.
\end{verbatim}
We get:
\begin{htmlout}
\newcommand{\open}{(}
\newcommand{\close}{)}
\open text opened by ``open'' and closed by
``close''\close.
\end{htmlout}
In the output above, the space after \verb+\open+ does not
find its way to the output.
\newcommand{\bfsymbol}{\mbox{\bf symbol}}

More generally,
\hevea{} tries to emulate \LaTeX{} behavior in all situations, but
discrepancies probably exist.
Thus, users are invited to make explicit what they want.
This is good practice anyway, because \LaTeX{} is mysterious
here. Consider the following example, where the \verb+\tryspace+
macro is first applied and then expansed by hand:
\begin{verbatim}
\newcommand{\bfsymbol}{\mbox{\bf symbol}}
\newcommand{\tryspace}[1]{#1 XXX}

Some space: \tryspace{\bfsymbol}\\
No space: \bfsymbol XXX
\end{verbatim}
Spacing is a bit chaotic here,
the space after \bfsymbol{} remains when \verb+#1+ is substituted for it
by \LaTeX{} (or \hevea).

\begin{htmlout}
\newcommand{\tryspace}[1]{#1 XXX}
\begin{tabular}{l@{~:~}l}
Some space & \tryspace{\bfsymbol}\\
No space   & \bfsymbol XXX
\end{tabular}%
%BEGIN LATEX
\par ~\vspace{-1ex}
%END LATEX
\end{htmlout}
Note that, if a space before ``XXX'' is wanted, then
one should probably write:
\begin{verbatim}
\newcommand{\tryspace}[1]{#1{} XXX}
\end{verbatim}


\subsection{Math mode}

\hevea{} math mode is not very far from normal text mode, except that
all letters are shown in italics and that space after macros
is echoed.

However, typesetting math formulas in \html{} rises two difficulties.
First, formulas contain symbols, such as Greek letters, second,
even simple formulas do not follow the simple basic typesetting model of
\html.


\subsubsection{Spacing in math mode}\label{spacemath}

By contrast with \LaTeX{}, spaces from the input are significant in
math mode, this
feature allows users to instruct \hevea{}
on how to put space in their formulas.
For instance, \verb+\alpha\rightarrow\beta+ is typeset without spaces between
symbols, whereas \verb+\alpha \rightarrow \beta+ produces these spaces.
\begin{htmlonly}
$$
\begin{array}{l@{ : }l}
\verb+\alpha\rightarrow\beta+ & \alpha\rightarrow\beta\\
\verb+\alpha \rightarrow \beta+ & \alpha \rightarrow \beta\\
\end{array}
$$
\end{htmlonly}
Note that \LaTeX{} ignores spaces in math mode, so that users can
freely adjust \hevea{} output without changing anything to \LaTeX{}
output.


\subsubsection{symbols}\label{symbols}
\begin{figure}[h]
\begin{center}
%BEGIN LATEX
\rule{0ex}{1ex}\epsfbox{xfd.ps}\rule{0ex}{1ex}
%END LATEX
\begin{rawhtml}
<IMG SRC="xfd.gif">
\end{rawhtml}
\end{center}
\caption{\label{xfd} Symbol font in X}
\end{figure}
Outputting symbols is performed using an \html{} extension:
the non-standard \verb+FACE+ attribute to the \verb+FONT+
element instruct the browser to switch to a symbol font.
\hevea{} assumes this choice for the symbol font to be
as shown by figure~\ref{xfd}.


A browser  correctly displays \hevea{} symbols when
figure~\ref{xfd} resembles the \html{} page located
at \localurl{symbol.html}.
Section~\ref{browser} explains how to configure a few browsers
to get the right symbols.

For authors that do not want to generate symbols that cannot be shown
by any browser, \hevea{} offers a degraded mode that outputs text
in place of symbols.
\hevea{} operates in this mode when given the \verb+-nosymb+ flag.
Replacement text is in English, unless
\hevea{} is also given the \verb+-francais+ flag. In that case
replacement text is in French.
For instance. the ``$\in$'' symbol is replace by ``in'' (or by ``appartient
à'' if French mode is selected).
This is far from being satisfactory, but degraded mode may be
appropriate for documents than contain few symbols.

\clearpage
\subsubsection{Displays}
Apart from containing symbols, formulas specify strong typesetting
constraints: sub-elements must be combined together following patterns
that departs from normal text typesetting. For instance, fractions
numerators and denominators must be placed one above the other.
\hevea{} handles such constraints in display mode only.


\hevea{} typesetting model for text is much simplified with respect to
\LaTeX{} LR and paragraph modes.
This does not harm for standard text input, which is rendered as a
series of paragraph.
However, this does not suffice for displayed math formulas and
\hevea{} offers a special ``display'' mode for typesetting them.

The main two operating modes of \hevea{} are \emph{text} mode and \emph{display}
mode.
Text mode is the mode for typesetting normal text,
when in this mode, \hevea{} should output text-level elements only,
text items are echoed one following the other,
paragraph breaks are just blank lines, both in input and output.

Display mode allows more control on text placement, since
entering display mode means opening
a \html{} \verb+TABLE+ element.
Displays come in two flavor, horizontal displays and vertical
displays.
An horizontal display is a one-row table, while a vertical display is
a one-column table. These tables holds display elements, displays
elements being centered vertically in horizontal display mode and
horizontally in vertical display mode.

Display mode is first opened by a \verb+displaymath+ environment.
Then, sub-displays are opened by \LaTeX{} constructs which require
them.
For instance, a displayed  fraction (\verb+\frac+) opens a vertical display.


The distinction between text and display modes clearly appears while
typesetting math formulas.
An in-text formula such as
\verb+$\int_1^2 xdx = \frac{3}{2}$+ appears as:
%HEVEA$\int_1^2 xdx =\frac{3}{2}$,
%BEGIN LATEX
\raisebox{-1ex}{\epsfbox{int.ps}},
%END LATEX
while the same formula has a better aspect in display mode:
%HEVEA$$\int_1^2xdx = \frac{3}{2}$$
%BEGIN LATEX
\begin{center}
~\epsfbox{intd.ps}~
\end{center}
%END LATEX
As a consequence, \hevea{} is more powerful in display mode and
formulas should be displayed as soon as they get a bit complicated.
This rule is also true in \LaTeX{} but it is more strict in \hevea{},
since \html{} capabilities to typeset formulas inside text are quite
poor.
In particular, all \html{} block-level elements start a new line.
Thus, it is not possible to get in-text ``real'' fractions or
in-text limit-like subscripts.

Users should remember that \hevea{} is not \TeX{} or \LaTeX{} and that
\hevea{} author neither is D.~E.~Knuth nor L.~Lamport.
Thus, some formulas may be rendered poorly.
For instance, two fractions with different denominator and numerator
height look strange.
\begin{htmlonly}
$$
\frac{1}{\sum_{i=0}^{N}U_i} = \frac{\sum_{i=0}^{N}U_i}{1}
$$
\end{htmlonly}
%BEGIN LATEX
\begin{center}
~\epsfbox{cloche.ps}~
\end{center}
%END LATEX
The reason is that vertical displays in an horizontal display are
boxes (i.e. \html{} tables)
that always get centered in the vertical direction.
Such a crude model cannot  faithfully emulate any \TeX{} box placement.


By contrast with formulas, which \hevea{} attempts to render with
text-level elements only when they appear inside paragraphs, arrays
are always translated to the
block-level element \verb+TABLE+, thereby introducing non-desired line
breaks before and after in-text arrays.
As a consequence, in-text arrays yield an acceptable output, only while
alone in a paragraph.


\begin{htmlonly}
Consider the following source:
\begin{verbatim}
This is a small array:
\begin{tabular}{|cc|}
\hline item-1 & item-2 \\
\hline\end{tabular}. Next sentence.
\end{verbatim}
We get:
\begin{htmlout}
This is a small array:
\begin{tabular}{|cc|}\hline item-1 & item-2
\\ \hline\end{tabular}. Next sentence.
\end{htmlout}
\end{htmlonly}

Taking into account the display nature of \html{} tables,
the \verb+array+ and \verb+tabular+ environments implicitly open
display mode.
As an immediate consequence, array elements are typeset in display
mode, which is not the case in \LaTeX.

Users can get an idea on how \hevea{} combines elements in display mode
by specifying the \verb+-v+ option, which instructs \hevea{} to add a
border to the \verb+TABLE+ elements introduced by displays.

\subsection{Warnings}
When \hevea{} thinks it cannot translate a symbol or construct
properly, it issues a warning. This draws user attention onto a
potential problem. However, rendering may be correct.

\begin{htmlonly}
In the following (silly) example, \hevea{} gets nervous  because of
the complicated length given as argument to \verb+\hspace+:
\begin{verbatim}
\setlength{\mylength}{5pt}
\begin{tabular}{c@{\hspace{\mylength}}c}
Before & After
\end{tabular}
\end{verbatim}
Running \hevea{} on this input produces a warning:
\begin{verbatim}
# hevea manual.tex
...
manual.tex:507: Warning: \hspace with arg ``\mylength''
...
\end{verbatim}
However the final rendering is correct:
\begin{htmlout}
\setlength{\mylength}{5pt}
\begin{tabular}{c@{\hspace{\mylength}}c}
Before & After
\end{tabular}
\end{htmlout}
\end{htmlonly}

Note that all warnings can be suppressed with the \verb+-s+ (silent)
option.
When a warning reveals a real problem, it can often be cured by
writing a specific macro. The next two sections introduce \hevea{}
macros, then section~\ref{trouble} describes how to proceed with
greater detail.

\subsection{Macros}
Just like \LaTeX{}, \hevea{} can be seen as a macro language, macros
are rewritten until no more expansion is possible. Then, either some
characters (such as letters, integers\ldots) are outputed or some
internal operation (such as changing font attributes, or arranging
text items in a certain manner) are performed.

This scheme favors easy extension of program capabilities
by users. However, predicting program behavior and correcting errors
may prove difficult, since final output or errors
may occur after several levels of macro expansion.
As a consequence, users can tailor \hevea{} to their needs, but it
remains a subtle task.
However, happy \LaTeX{} users should enjoy customizing
\hevea{}, since this is done by writing \LaTeX{} code.



\subsection{Style choices}
\LaTeX{} and {\html} differ in many aspects. For instance, \LaTeX{} allows
fine control over text placement, whereas
{\html} does not.
More symbols and font attributes are available in \LaTeX{} than in
{\html}. However, {\html} has font attributes, such as color, which
standard \LaTeX{} has not.

As a consequence, there are many situations where \hevea{} just cannot
render the visual effect of \LaTeX{} constructions. Here some choices
have to be made. For instance, the calligraphic letters (\verb+\mathcal+)
are rendered in red (\verb+<FONT COLOR=red>+), and the small caps
(\verb+\scshape+) are rendered in bold font (\verb+<B>+).

If you are not satisfied with \hevea{} rendering of text style
declarations, then you
can choose your own, by redefining the \verb+\cal+ and \verb+\sc+
macros, using \verb+\renewcommand+, the macro redefinition operator of
\LaTeX{}. The key point is that you need not worry with \hevea{}
internals~: just redefine the old-\LaTeX{} style text-style
declarations (i.e. \verb+\it+, \verb+\sc+, etc.) and everything should
get fine~:
\begin{verbatim}
\renewcommand{\sc}{\Huge}
\renewcommand{\cal}{\em}
\end{verbatim}
(See sections~\ref{trouble} and~\ref{both} on how to make such
changes while leaving your file processable by \LaTeX{}).

\begin{htmlonly}
With such redefinitions, we get:
\renewcommand{\sc}{\Huge}
\renewcommand{\cal}{\em}
\begin{htmlout}
This is \textsc{small caps} and this is $\cal CALLIGRAPHIC LETTERS$
\end{htmlout}
\end{htmlonly}


Note that many base macros and environments are defined in the 
\texttt{hevea.hva} file that \hevea{} loads before processing any
input.
These macros are written using \LaTeX{} source code.
Having a look at the \texttt{hevea.hva} file
will help you in designing your own implementation
of base macros.

Other base macros that require a special processing are defined
in \hevea{} source code.
However, most of these macro definitions can be overridden by a
redefinition.
There remains a small number of macros that cannot be changed.
They are either \hevea{} internal macros that finally output {\html},
or \LaTeX{} core macros and environments, such as \verb+\newcounter+
or \verb+array+.
If you attempt to define or redefine these macros, nothing should happen.


\section{How to detect and correct errors}\label{trouble}

Most of the problems that occur during the translation of a given
\LaTeX{} file (say \verb+trouble.tex+) can be detected and solved at
the macro-level. That is, most problems induce a macro-related warning
and can be solved by writing a few
macros. The best place for these macros is an user-style file (say
\texttt{trouble.hva}) given as
argument to \hevea.
\begin{verbatim}
# hevea trouble.hva trouble.tex
\end{verbatim}
By doing so, the macros written specially for \hevea{} are not
seen by \LaTeX. Even better, \verb+trouble.tex+ is not changed
at all.

Of course, this will be easier if the \LaTeX{} source is written in a
generic style, using macros.
Note that this style is recommended anyway, since it eases the changing
and tuning of documents.

\subsection{\hevea{} does not know a macro}\label{dontknow}
Consider the following \LaTeX{} source excerpt:
\begin{verbatim}
You can \raisebox{.6ex}{\em raise} text.
\end{verbatim}

\LaTeX{} typesets this as follows:
\begin{htmlout}
\begin{showlatex}
You can \raisebox{.6ex}{\em raise} text.
\end{showlatex}
\end{htmlout}

Since \hevea{} does not know about \verb+\raisebox+,
it incorrectly processes this input. More precisely,
it first prints a warning message:
\begin{verbatim}
trouble.tex:34: Unknown macro: \raisebox
\end{verbatim}
Then, it goes on by translating the arguments of \verb+\raisebox+ as if
they were normal text. As a
consequence some \verb+.6ex+ is finally found in the {\html} output:
\begin{htmlout}
\begin{showlatex}
You can .6ex{\em raise} text.
\end{showlatex}
\end{htmlout}

To correct this, you should provide a macro that has more or less the effect of
\verb+\raisebox+. It is impossible to write a generic
\verb+\raisebox+ macro for \hevea, because of \html{} limitations.
However, in this case, the effect
of \verb+\raisebox+ is to raise the box {\em a little}.
Thus, the first, numerical, argument to \verb+\raisebox+  can be
ignored in a private \verb+\raisebox+ macro defined in \texttt{trouble.hva}:
\begin{verbatim}
\newcommand{\raisebox}[2]{$^{\mbox{#2}}$}
\end{verbatim}

Now, translating the document yields:
\begin{htmlout}
\renewcommand{\raisebox}[2]{$^{\mbox{#2}}$}%
You can \raisebox{.6ex}{\em raise} text a little.
\end{htmlout}

Of course, this will work only when all \verb+\raisebox+ commands in
the document raise text a little. Consider, the following
example, where text
is both raised a lowered a little:
\begin{verbatim}
You can \raisebox{.6ex}{\em raise}
or \raisebox{-.6ex}{\em lower} text.
\end{verbatim}
Which \LaTeX{} renders as follows:
\begin{htmlout}
\begin{showlatex}
You can \raisebox{.6ex}{\em raise} or \raisebox{-.6ex}{\em lower} text.
\end{showlatex}
\end{htmlout}
Whereas, with the above definition of \verb+\raisebox+, \hevea{} produces:
\begin{htmlout}
\renewcommand{\raisebox}[2]{$^{\mbox{#2}}$}%
You can \raisebox{.6ex}{\em raise}
or \raisebox{-.6ex}{\em lower} text.
\end{htmlout}


A solution is to add a new macro definition in the \verb+trouble.hva+ file:
\begin{verbatim}
\newcommand{\lowerbox}[2]{$_{\mbox{#2}}$}
\end{verbatim}
Then, \verb+trouble.tex+ itself has to be modified a little.
\begin{verbatim}
You can \raisebox{.6ex}{\em raise}
or \lowerbox{-.6ex}{\em lower} text.
\end{verbatim}
\hevea{} now produces a satisfying output:
\begin{htmlout}
\begin{showlatex}%
\renewcommand{\raisebox}[2]{$^{\mbox{#2}}$}%
\newcommand{\lowerbox}[2]{$_{\mbox{#2}}$}
You can \raisebox{.6ex}{\em raise}
or \lowerbox{-.6ex}{\em lower} text.
\end{showlatex}
\end{htmlout}

Note that, for the document to remain \LaTeX{}-processable,
it should also contain the following definition for
\verb+\lowerbox+:
\begin{verbatim}
\newcommand{\lowerbox}[2]{\raisebox{#1}{#2}}
\end{verbatim}
This definition can safely be placed anywhere in \texttt{trouble.tex},
since by \hevea{} semantics for \verb+\newcommand+ (see
section~\ref{usermacro})
the new definition will not overwrite the old one.

\subsection{\hevea{} incorrectly interprets a macro}\label{blob}

Sometimes \hevea{} knows about a macro, but the produced \html{}
does not look good when seen through a browser.
This kind of errors is detected while visually checking the
output.
However, \hevea{} does its best to issue warnings when such situations
are likely to occur.

Consider, for instance, this definition of \verb+\blob+ as a small
black square.
\begin{verbatim}
\newcommand{\blob}{\rule[.2ex]{1ex}{1ex}}
\blob\ Blob \blob
\end{verbatim}
Which \LaTeX{} typesets as follows:
\begin{latexout}
%BEGIN IMAGE
\newcommand{\blob}{\rule[.2ex]{1ex}{1ex}}
\blob\ Blob \blob
%END IMAGE
%HEVEA\imageflush%
\end{latexout}
\hevea{} always translates \verb+\rule+ as \verb+<HR>+, ignoring size
arguments.
Hence, it produces the following, wrong, output:
\begin{htmlout}\newcommand{\blob}{\rule[.2ex]{1ex}{1ex}}
\begin{htmlonly}
\blob\ Blob \blob
\end{htmlonly}
\begin{latexonly}\vspace*{.5ex}
\epsfbox{blob.ps}%
\end{latexonly}%
\end{htmlout}

There is not small square in the symbol font used by \hevea.
However there are other small symbols that would perfectly do the job
of \verb+\blob+, such as a bullet (\verb+\bullet+).
Thus, you may choose to give \verb+\blob+ a definition in
\verb+trouble.hva+:
\begin{verbatim}
\newcommand{\blob}{\bullet}
\end{verbatim}
This new definition yields the following, more satisfying output:
\begin{htmlout}\newcommand{\blob}{\bullet}%
\begin{htmlonly}%
\blob\ Blob \blob
\end{htmlonly}
\begin{latexonly}\vspace*{.5ex}
\epsfbox{blob2.ps}%
\end{latexonly}%
\end{htmlout}

Now, if you insist on having a square ``blob'', you can.
It suffices to have \LaTeX{} typeset some subparts of
the document and then to include them as images, section~\ref{imagen}
explain how to proceed.


\subsection{\hevea{} crashes}

\hevea{} failure may have many causes, including a bug.
However, it may also stem from a wrong \LaTeX{} input.
Thus, this section is to be read before reporting a bug\ldots

In  the following source, environments are not properly balanced:
\begin{verbatim}
\begin{flushright}
\begin{quote}
This is right-flushed quoted text.
\end{flushright}
\end{quote}
\end{verbatim}
Such a source will make both \LaTeX{} and \hevea{} choke.
\hevea{} issues the following error message that shows the \LaTeX{}
environment that is not closed properly:
\begin{verbatim}
trouble.tex:7: hml: DIV closes BLOCKQUOTE
trouble.tex:5: Latex environment ``quote'' is pending
Fatal error: uncaught exception Failure("Adios")
\end{verbatim}
Thus, when \hevea{} crashes, it is a good idea to check that the
input is correct by running \LaTeX{} on it.


Unfortunately, \hevea{} may crash on input that does not affect
\LaTeX.
Such errors are likely to appear when processing \TeX-ish input,
such as found in style files.
Consider for instance the following ``optimized'' version of a
\verb+quoteright+  environment:
\begin{verbatim}
\newenvironment{quoteright}{\quote\flushright}{\endquote}

\begin{quoteright}
This a right-flushed quotation
\end{quoteright}
\end{verbatim}

The \verb+\flushright+ construct is intended to replace
\verb+\begin{flushright}+ and the closing \verb+\endflushright+
is omitted, since it does nothing.
\LaTeX{} accepts such an input and produces a  right-flushed quotation.

However, when \hevea{} translates an environment \textit{env}
by a block-level element, it proceeds as follows:
the \verb+\+\textit{env} macro opens the element, while the
\verb+\end+\textit{env} macro closes it.
As a consequence, \verb+\quote+ translates to, \verb+<BLOCKQUOTE>+,
\verb+\flushright+ translates to \verb+<DIV ALIGN=right>+ and
\verb+\endquote+ translates to \verb+</BLOCKQUOTE>+.
At that point, \hevea{} refuses to generate obviously
non-correct {\html} and it crashes:
\begin{verbatim}
trouble.tex:9: hml: BLOCKQUOTE closes DIV
trouble.tex:7: Latex environment ``quoteright'' is pending
Fatal error: uncaught exception Failure("Adios")
\end{verbatim}

In this case, the solution is easy: environments must be opened and
closed consistently. \LaTeX{} style being recommended, one should write:
\begin{verbatim}
\newenvironment{quoteright}
  {\begin{quote}\begin{flushright}}
  {\end{flushright}\end{quote}}
\end{verbatim}
And we get:
\begin{htmlout}\newenvironment{quoteright}{\begin{quote}\begin{flushright}}{\end{flushright}\end{quote}}
\begin{htmlonly}
\begin{quoteright}
This is a right-flushed quotation
\end{quoteright}
\end{htmlonly}
\begin{latexonly}\vspace*{.5ex}
\epsfbox{rquote.ps}
\end{latexonly}
\end{htmlout}


\section{Making \hevea{} and \LaTeX{} both happy}\label{both}
A satisfactory translation from \LaTeX{} to \html{} often requires
giving instructions to \hevea{}.
Typically, these instructions are macro definitions and
these instructions should not be seen by \LaTeX{}.
Conversely, some source that \LaTeX{} needs should not be processed
by \hevea{}.
Basically, there are three ways to make input vary according to the
processor, file loading, the \texttt{hevea.sty} style
file and comments.


\subsection{File loading}\label{fileloading}

\hevea{} and \LaTeX{} treat files differently. Here is a summary of the main
differences:

\begin{itemize}
  \item \LaTeX{} loads style files given as optional arguments to
  \verb+\documentstyle+ and as arguments to \verb+\usepackage+. \hevea{}
  does not.
  \item \LaTeX{} and \hevea{} both load files given as arguments to
  \verb+\input+, however when given the option \verb+-e+~\filename{filename},
  \hevea{} does not load \filename{filename}.
  \item \hevea{} loads all files given as command line arguments.
\end{itemize}

As a consequence, for having a file \filename{latexonly} loaded by
\LaTeX{} only, it suffices either to load the file in the document
source as:
\begin{flushleft}
\verb+\usepackage{+\filename{latexonly}\verb+}+
\end{flushleft}
Or, as
1\begin{flushleft}
\verb+\documentstyle[+\ldots,
\filename{latexonly},\ldots\verb+]{+\ldots\verb+}+
\end{flushleft}
Another solution is  to use \verb+\input{+\filename{latexonly}\verb+}+
in the source and to invoke \hevea{} as follows:
\begin{flushleft}
\verb+# hevea+ \texttt{-e} \filename{latexonly}\ldots
\end{flushleft}

Having \filename{heveaonly} loaded by \hevea{} only is more
simple: it  suffices to invoke \hevea{} as follows:
\begin{flushleft}
\verb+# hevea+ \filename{heveaonly}\ldots
\end{flushleft}
Using an \hevea{}-specific style file given as a command line argument
is the method of choice for supplying command definitions
to \hevea{} only. Users can then be sure that these definitions are
not seen by \LaTeX{} and will not get echoed to the \textit{image}
file (see section~\ref{imagen}).


\subsection{The \protect\texttt{hevea.sty} style file}
The \texttt{hevea.sty} style file is intended to be loaded by \LaTeX{}
and not by \hevea{}.
It provides \LaTeX{} with means to ignore or process some parts of the
document.
Note that \hevea{} copes with the constructs defined in
the \texttt{hevea.sty} file by default.

\subsubsection{Selecting a translator}
\hevea{} and \LaTeX{} perform the following actions on source inside
the  \verb+latexonly+, \verb+verblatex+, \verb+htmlonly+, \verb+rawhtml+,
\verb+toimage+ and \verb+verbimage+ environments:
\begin{center}
\begin{tabular}{l@{~}p{.5\linewidth}@{\quad}l}\hline
environment & \multicolumn{1}{c}{\hevea} &  \multicolumn{1}{c}{\LaTeX}
\\ \hline
\verb+latexonly+ & ignore, \verb+\end{+\textit{env}\verb+}+
constructs are processed  & process \\
\verb+verblatex+ & ignore & process \\
\verb+htmlonly+ & process & ignore \\
\verb+rawhtml+  & echo verbatim & ignore\\
\verb+toimage+&
send to the \filename{image} file, \verb+\end{+\textit{env}\verb+}+
constructs and macro characters are processed (see section~\ref{imagen})  &
process\\
\verb+verbimage+&
send to the \filename{image} file (see section~\ref{imagen})  &
process\\
\hline
\end{tabular}
\end{center}

\noindent As an example, this is how some text can be typeset in purple by
\hevea{} and left alone by \LaTeX{}:
\begin{verbatim}
We get:
\begin{htmlonly}\purple purple rain, purple rain\end{htmlonly}%
\begin{latexonly}purple rain, purple rain\end{latexonly}%
\ldots
\end{verbatim}
We get:
\begin{htmlonly}
\purple purple rain, purple rain
\end{htmlonly}
\begin{latexonly}
purple rain, purple rain
\end{latexonly}
\ldots

Note that environments define a scope and that style changes
(and non-global definitions) are local to them. For instance, in the
example above, ``\ldots'' appears in black in \html{} output.


Another choice is using the \TeX{} style conditional macros \verb+\ifhevea+,
which \hevea{} sees as true and \LaTeX{} as false:
\begin{verbatim}
We get:
{\ifhevea\purple\fi purple rain, purple rain}\ldots
\end{verbatim}
We get: {\ifhevea\purple\fi purple rain, purple rain}\ldots

\subsubsection{Why is there a \texttt{verblatex} environment?}
Some scanning and analysis of source is performed
by \hevea{} inside the \texttt{latexonly} environment, in order to
allow  \texttt{latexonly} to dynamically occur inside other environments.

More specifically, \verb+\end{+\textit{env}\verb+}+ macros
are recognized and their \textit{env} argument is tested against
the name of the environment whose opening macro \verb+\+\textit{env}
opened the \texttt{latexonly} environment.
In that case, macro expansion of \verb+\end+\textit{env} is performed and
any further occurrence of  \verb+\end{+\textit{env'}\verb+}+ is tested
and may get expanded if it matches a pending
\verb+\begin{+\textit{env'}\verb+}+
construct.


This enables playing tricks such as:
\begin{verbatim}
\newenvironment{latexhuge}
  {\begin{latexonly}\huge}
  {\end{latexonly}}

\begin{latexhuge}
This will appear in huge font in \LaTeX{} output only.
\end{latexhuge}
\end{verbatim}
\LaTeX{} output will be:
\begin{latexout}
\begin{showlatex}
\newenvironment{latexhuge}
  {\begin{latexonly}\huge}
  {\end{latexonly}}
\begin{latexhuge}
This  will appear in huge font in \LaTeX{} output only.
\end{latexhuge}
\end{showlatex}
\end{latexout}
\noindent While there is no \hevea{} output.

Since \hevea{} somehow analyses input that is enclosed in the
\texttt{latexonly} environment,
it may choke.
However, this environment is intended to select processing by
\LaTeX{} only and might contain arbitrary source code.
Fortunately, it remains possible to have input processed by \LaTeX{}
only, regardless of what it is, by enclosing it in the
\texttt{verblatex} environment.
Inside this environment, \hevea{} performs no other action
than looking for \verb+\end{verblatex}+. As a consequence,
the \verb+\begin{verblatex}+ and \verb+\end{verblatex}+ constructs
may only appear in the main flow of text or inside the same macro body,
a bit like \LaTeX{} \texttt{verbatim} environment.


Relations between \texttt{toimage} and \texttt{verbimage} are similar.
Additionally, formal parameters \verb+#+\textit{i} are replaced by
actual arguments inside the \texttt{toimage} environment
(see end of section~\ref{substimage} for an example of this feature).

\subsubsection{Bonus macros}
By default, \hevea{} knows some macros to process a few \html-related
constructs.
The \texttt{html} package defines \LaTeX{} equivalents for them.
This first concerns the \hevea{} and \hacha{} logos.
Then, a few macros for URL management are provided

%BEGIN LATEX
\bigskip
%END LATEX
\begin{tabular}{l@{\qquad}p{.3\linewidth}@{\qquad}p{.3\linewidth}}
Macro & \multicolumn{1}{c}{\hevea} &  \multicolumn{1}{c}{\LaTeX}\\
\hline

\verb+\url{+\textit{url}\verb+}{+\textit{text}\verb+}+ &
make \textit{text} an hyper-link to \textit{url} &
echo \textit{text}\\ \hline

\verb+\footurl{+\textit{url}\verb+}{+\textit{text}\verb+}+ &
make \textit{text} an hyper-link to \textit{url} &
make \textit{url} a footnote to \textit{text},
\textit{url} is shown in typewriter font\\ \hline

\verb+\oneurl{+\textit{url}\verb+}+ &
make \textit{url} an hyper-link to \textit{url}.
&
typeset \textit{url} in typewriter font\\ \hline
\verb+\mailto{+\textit{address}\verb+}+ &
make \textit{address} a ``mailto'' link to \textit{address} &
typeset \textit{address} in typewriter font\\ \hline
\verb+\home{+\textit{text}\verb+}+ &
\multicolumn{2}{p{.6\linewidth}}{produce a home-dir url both for output and links, output aspect is: ``\home{\textit{text}}''}
\end{tabular}

\medskip\noindent The \textit{url} and \textit{address} arguments undergo macro
substitution, however style changes are ignored in the
``\verb+HREF=...+'' attribute of the \verb+<A ...>+ element.
As a consequence one can safely write something like:
\begin{verbatim}
\mailto{Luc.Maranget@\textit{inria}.\texttt{fr}}
\end{verbatim}
And one gets \mailto{Luc.Maranget@\textit{inria}.\texttt{fr}}.
That is, one gets the following correct link:
\begin{verbatim}
<A HREF="mailto:Luc.Maranget@inria.fr">...
\end{verbatim}

Additionally, the \verb+\imageflush+ macro that controls included images
(see section~\ref{imagen}) and the \verb+\cuttingunit+,
\verb+\cuthere+, etc. macros that
control document cutting (see
section~\ref{hacha})
are defined as null macros in the \texttt{hevea.sty} file.

\subsection{Comments}\label{comments}
\hevea{} processes all lines that start with \verb+%HEVEA+, while
\LaTeX{} treats these lines as comments.
Thus the ``purple rain'' example can be
rephrased as follows:
\begin{verbatim}
We get
%HEVEA{\purple
purple rain, purple rain%
%HEVEA}%
\ldots
\end{verbatim}
(Note how comments are placed at the end of some lines to avoid spurious spaces
in the final output.)

We get:
%HEVEA{\purple
purple rain, purple rain%
%HEVEA}%
\ldots

Comments thus provide an alternative to loading the
\texttt{html} package. For user convenience, comment equivalents to
the \verb+latexonly+ and \verb+toimage+ environment are also provided:
\begin{center}
\begin{tabular}{ll}\hline
\multicolumn{1}{c}{environment} & \multicolumn{1}{c}{comment
equivalent}\\ \hline
\verb+\begin{latexonly}+\ldots{} \verb+\end{latexonly}+ &
\begin{tabular}{l}
\verb+%BEGIN LATEX+ \\
\ldots \\
\verb+%END LATEX+
\end{tabular}
\\ & \\ \hline
\verb+\begin{toimage}+\ldots{} \verb+\end{toimage}+ &
\begin{tabular}{l}
\verb+%BEGIN IMAGE+ \\
\ldots \\
\verb+%END IMAGE+
\end{tabular}
\end{tabular}
\end{center}
Note that \LaTeX{}, by ignoring comments, naturally performs the action
of processing text between \verb+%BEGIN+\texttt{\ldots} and %
\verb+%END+\texttt{\ldots} %
comments. However, no environment is opened and closed and no scope is
created while using comment equivalents.


\section{With a little help from \LaTeX}\label{imagen}
Sometimes,
\hevea{} just cannot process its input, but it remains acceptable to
have \LaTeX{} process it, to produce a \texttt{.gif} image from
\LaTeX{} output and to include a link to this image into \hevea{}
output.
\hevea{} provides a limited support for doing this, which always remains
under user control.

\subsection{The \filename{image} file}

While outputting \filename{mydoc}\texttt{.html}, \hevea{} echoes some
of its input to the \filename{image} file,
\filename{mydoc}\texttt{.image.tex}.

Part of this process is done at the user's request.
More precisely, the following two constructs
send \textit{text} to the \filename{image} file:
\begin{flushleft}
\verb+\begin{toimage}+\\
\textit{text}\\
\verb+\end{toimage}+\\
~\\
\verb+%BEGIN IMAGE+\\
\textit{text}\\
\verb+%END IMAGE+
\end{flushleft}
Additionally, the \verb+\documentclass+ command, \verb+\usepackage+
commands, top-level or
global macros definitions and environment definitions
are automatically echoed to the image file. This enables using
document-specific commands in \textit{text} above.


Output to the image file builds up a current page, which is flushed
by the \verb+\imageflush+ command.
This command has the following effect:  it outputs a strict page break
in the \filename{image} file, increments the image counter and
output a \verb+<IMG SRC="+\textit{pagename}\verb+.gif">+ element in \hevea{}
output file, where \textit{pagename} is build from the image counter
and \hevea{} output file name.

Then the \verb+imagen+ script has to be run by:
\begin{flushleft}
\verb+# imagen+ \textit{mydoc}
\end{flushleft}
\noindent This will process the \filename{mydoc}\texttt{.image.tex}
file through \LaTeX,
\texttt{dvips}, \texttt{ghostscript} and a few others tools, which must all be
present  (see section~\ref{requirements}), finally producing one
\textit{pagename}\texttt{.gif} file per page in the \filename{image}
file.

The  usage of \verb+imagen+  is described at
section~\ref{imagenusage}. Note that \texttt{imagen} is a simple shell
script.



\subsection{A toy example}
Consider the ``blob'' example from the section~\ref{blob}.
Here is the active part of a \texttt{blob.tex} file:
\begin{verbatim}
\newcommand{\blob}{\rule[.2ex]{1ex}{1ex}}
\blob\ Blob \blob
\end{verbatim}
This time, we would like \verb+\blob+ to produce a small black square, which
\verb+\rule[.2ex]{1ex}{1ex}+ indeed does in \LaTeX{}.
Thus we can write:
\begin{verbatim}
\newcommand{\blob}{%
\begin{toimage}\rule[.2ex]{1ex}{1ex}%
\end{toimage}%
\imageflush}
\blob\ Blob \blob
\end{verbatim}
Now we issue the following two commands:
\begin{verbatim}
# hevea blob.tex
# imagen blob
\end{verbatim}
And we get:
\begin{htmlout}
\begin{htmlonly}
\newcommand{\blob}{%
\begin{toimage}\rule[.2ex]{1ex}{1ex}%
\end{toimage}%
\imageflush}\newsavebox{\blobbox}\sbox{\blobbox}{\blob}
\usebox{\blobbox}\ Blob \usebox{\blobbox}
\end{htmlonly}
\begin{latexonly}\vspace*{.5ex}
\epsfbox{realblob.ps}
\end{latexonly}%
\end{htmlout}

Observe that the trick can be used to replace missing symbols by small
\texttt{.gif} images. However, the cost may be prohibitive, text rendering
is generally bad, fine placement is ignored and font style changes are
problematic.
Cost can be lowered using \verb+\savebox+, but the other problems remain.


\subsection{Including Postscript images}\label{substimage}
Such images are easy to manage: it suffices to let \LaTeX{} do the
job.
Let \texttt{round.ps} be a Postscript file, which is included as an
image in the source file \texttt{round.tex} (which must load the
\filename{epsf} package):
\begin{verbatim}
\begin{center}
\epsfbox{round.ps}
\end{center}
\end{verbatim}
Then, \hevea{} can have this image translated into a inlined (and
centered) \texttt{.gif} image by modifying source as follows:
\begin{verbatim}
\begin{center}
%BEGIN IMAGE
\epsfbox{round.ps}
%END IMAGE
%HEVEA\imageflush
\end{center}
\end{verbatim}
(Note that the \texttt{round.tex} file
still can be processed by \LaTeX, since comment equivalents
of the \texttt{toimage} environment are used and that
the \verb+\imageflush+ command is  inside
a \verb+%HEVEA+ comment --- see section~\ref{comments}.)

Then, processing \texttt{round.tex} through \hevea{} and
\texttt{imagen} yields:
\begin{htmlout}
\begin{center}
%BEGIN IMAGE
~\epsfbox{round.ps}~%
%END IMAGE
%HEVEA\imageflush
\end{center}
\end{htmlout}
It is important to notice that things go smoothly
because the \verb+\usepackage{epsf}+ command gets echoed to the
\filename{image} file.
In more complicated cases, \LaTeX{} may fail on the \filename{image}
file because it does not load the right packages or define the right macros.

However, the above solution implies modifying the original \LaTeX{}
source code.
A better solution is to define the \verb+\epsfbox+
command, so that \hevea{} echoes  \verb+\epsfbox+ and its argument to
the image file and performs \verb+\imageflush+:
\begin{verbatim}
\newcommand{\epsfbox}[1]{%
\begin{toimage}
\epsfbox{#1}%
\end{toimage}
\imageflush}
\end{verbatim}
Such a definition must be seen by \hevea{} only. So, it is best put
in a separate file whose name is given as an extra argument on
\hevea{} command line (see section~\ref{fileloading}).
Putting it in the document source
protected inside an \verb+%HEVEA+ comment is a bad idea, %
because it might then get echoed to the \textit{image} file
and generate trouble when \LaTeX{} is later run by \texttt{imagen}.

Observe that the above definition of \verb+\epsfbox+ is a definition
and not a redefinition (i.e., \verb+\newcommand+ is used and not
\verb+\renewcommand+),
because \hevea{} does not know about \verb+\epsfbox+ by default.
Also observe that this not a recursive definition, since
commands do not get expanded inside the \verb+toimage+ environment.

\subsection{Using filters}

Some programs extend \LaTeX{} capabilities using a filter principle.
In such a scheme, the document contains source fragments for the program.
A first run of the program on \LaTeX{} source changes these fragments
into constructs that \LaTeX{} (or a subsequent stage in the paper
document production chain, such as \texttt{dvips}) can handle.
Here again, the rule of the game is keeping \hevea{} away from the
normal process: first applying the filter, then making \hevea{} send
the filter output to the \filename{image} file, and then having
\texttt{imagen} do the job.


Consider the \texttt{gpic} filter, for making drawings.
Source for \texttt{gpic} is enclosed in \verb+.PS+\ldots \verb+.PE+,
then the result is available to subsequent \LaTeX{} source as a \TeX{}
box \verb+\box\graph+.
For instance the following source, from a \texttt{smile.tex} file,
draws a ``Smile!'' logo as a centered
paragraph:
\begin{verbatim}
 .PS
ellipse "{\Large\bf Smile!}"
.PE
\begin{center}
~\box\graph~
\end{center}
\end{verbatim}
Both the image description (\verb+.PS+\ldots\ \verb+.PE+) and usage (\verb+\box\graph+)
are for the \filename{image} file, and they should be
enclosed by \verb+%BEGIN IMAGE+\ldots\ \verb+%END IMAGE+ comments.
Additionally, the image link is put where it belongs by an
\verb+\imageflush+ command:
\begin{verbatim}
%BEGIN IMAGE
 .PS
ellipse "{\Large\bf Smile!}"
.PE
%END IMAGE
\begin{center}
%BEGIN IMAGE
~\box\graph~
%END IMAGE
%HEVEA\imageflush
\end{center}
\end{verbatim}
The \texttt{gpic} filter is applied first, then come \texttt{hevea}
and \texttt{imagen}:
\begin{verbatim}
# gpic -t < smile.tex > tmp.tex
# hevea tmp.tex -o smile.html
# imagen smile
\end{verbatim}
And we get:
%BEGIN IMAGE
.PS
ellipse "{\Large\bf Smile!}"
.PE
%END IMAGE
\begin{center}
%BEGIN IMAGE
~\box\graph~
%END IMAGE
%HEVEA\imageflush
\end{center}
Observe how the \verb+-o+ argument to \hevea{} is used and that
\texttt{imagen} argument is the output file base name.


In the \texttt{gpic} example, modifying user source cannot be totally avoided.
However, writing in a generic style saves typing.
For instance, users may define the following environment for
centered \texttt{gpic} pictures in \LaTeX{}~:
\begin{verbatim}
\newenvironment{centergpic}{}{\begin{center}~\box\graph~\end{center}}
\end{verbatim}
Source code will now be as follows:
\begin{verbatim}
\begin{centergpic}
 .PS
ellipse "{\Large\bf Smile!}"
.PE
\end{centergpic}
\end{verbatim}
\hevea will process this source correctly, provided it is given its
own definition for the \verb+centergpic+ environment beforehand:
\begin{verbatim}
\newenvironment{centergpic}
  {\begin{toimage}}
  {\box\graph\end{toimage}\begin{center}\imageflush\end{center}}
\end{verbatim}
Assuming that the definition above is in a \urlex{smile.hva} file,
the command sequence for translating
\urlex{smile.tex} \mbox{now is}:
\begin{verbatim}
# gpic -t < smile.tex > tmp.tex
# hevea smile.hva tmp.tex -o smile.html
tmp.tex:5: Warning: ignoring definition of \centergpic
tmp.tex:5: Warning: not defining environment centergpic
# imagen smile
\end{verbatim}
The warnings above are normal~: they are issued when \hevea{} runs
across the \LaTeX{}-intended definition of the \verb+centergpic+
environment and refuses to override its own definition for that
environment.


\section{Cutting your document into pieces with {\hacha}}\label{hacha}
\hevea{} outputs a single \texttt{.html} file. This file can be
cut into pieces at various sectional units by {\hacha}
\subsection{Simple usage}
First generate your {\html} document by applying \hevea{}:
\begin{flushleft}
\texttt{\# hevea }\filename{mydoc}\texttt{.tex}
\end{flushleft}
Then cut \filename{mydoc}\texttt{.html} into pieces by the command:
\begin{flushleft}
\texttt{\# hacha }\filename{mydoc}\texttt{.html}
\end{flushleft}
This will generate a simple root file
\texttt{index.html}.
This root file holds document title, abstract and a simple table of
contents.
Every item in the table of contents contains a link to or into a file
that holds a ``cutting'' sectional unit.
By default, the cutting sectional unit is {\em section} in the
\filename{article} style and {\em chapter} in the \filename{book}
style.

Additionally, one level of sectioning below the cutting unit (i.e.,
subsections in the \filename{article} style and sections in the
\filename{book} style) is shown
as an entry in the table of contents.
Sectional units above the cutting section (i.e., parts in both
\filename{article} and \filename{book} styles) close the current table
of contents and open a new one.
Cross-references are properly handled, that is the local links generated by
\hevea{} are changed into remote links.

The name of the root  file can be changed using the
\verb+-o+ option:
\begin{flushleft}
\texttt{\# hacha -o root.html }\filename{mydoc}\texttt{.html}
\end{flushleft}

\subsection{Advanced usage}

\hacha{} behavior can be altered from the document source, by using
a counter and a few macros.

A document that explicitly includes cutting macros still can be typeset by
\LaTeX{}, provided it loads the
\texttt{html} package from the \hevea{} distribution.
(See section~\ref{both} for details on the \texttt{html} package).
An alternative to loading the \texttt{html} package is to put
all cutting instructions in comments starting with \verb+%HEVEA+.



\subsubsection{Principle}
{\hacha} recognizes five sectional units, ordered as follows, from
top to bottom: {\em
part}, {\em chapter},
{\em section}, {\em subsection} and {\em subsubection}.

At any point between \verb+\begin{document}+ and
\verb+\end{document}+,
there exist a current cutting sectional unit (cutting unit for short),
a current cutting depth, a root file and an output file.
Table of contents output goes to the root file, normal output goes to
the output file.
Cutting units start a new output file, whereas units comprised between the
cutting unit and the cutting units plus the cutting depth add new
entries in the table of contents.

At document start, the root file and the output file are {\hacha}
output file (i.e., \texttt{index.html}).
The cutting unit and the cutting depth are set to default values that
depend on the document style.

\subsubsection{Cutting macros}
The following cutting instructions are for use in the document
preamble. They command the cutting scheme of the whole document:
\begin{description}
\item[{\tt\char92 cuttingunit}]
This is a macro that holds the document cutting unit. You can change
the default (which is {\em section} in the \filename{article} style
and {\em chapter} in the \filename{book} style)  by doing:
\begin{flushleft}
\verb+\renewcommand{\cuttingunit}{+{\it secname}\verb+}+.
\end{flushleft}
\item[{\tt cuttingdepth}]
This is a counter that holds the document cutting depth.
You can change the default value of 1 by doing
\verb+\setcounter{cuttingdepth}{+{\it numvalue}\verb+}+.
A cutting depth of zero means no other entries than the cutting units
in the table of contents.
\end{description}

Other cutting instructions are to be used after
\verb+\begin{document}+. They all generate \html{} comments in \hevea{}
output.
These comments then act as instructions to {\hacha}.

\begin{description}
\item[{\tt\char92 cuthere\{}{\it secname}{\tt\}\{}{\it itemtitle}{\tt\}}]
   Attempt a cut.
   \begin{itemize}
   \item If {\it secname} is the current cutting  unit or
   the keyword ``\texttt{now}'', then
   a new output file is started and an entry in the current table of contents
   is generated, with title {\it itemtitle}. This entry holds a link
   to the new output file.
   \item If {\it secname} is above the cutting  unit, then the
   current table of contents is closed. The output file is set to the
   current root file.
   \item If {\it secname} is below the cutting  unit and less than the
   cutting depth away from it, then an entry is added in the table of
   contents.
   This entry contains {\em itemtitle} and a link to the point where
   \verb+\cuthere+ appears.
   \item Otherwise, no action is performed.
   \end{itemize}

\item[{\tt\char92 cutdef[}{\it depth}{\tt]\{}{\it secname}{\tt \}}]
   Open a new table of contents, with cutting depth~{\em depth} and
   cutting unit {\em secname}. If the optional {\em depth} is absent,
   the cutting depth does not change.
   The output file becomes the root file.
   Result is unspecified if whatever {\em secname} expands to is
   a sectional unit name above
   the current cutting  unit, is not a valid sectional unit name or if
   {\em depth} does not expand to a small positive number.
\item[{\tt\char92 cutend}]
   End the current table of contents. This closes the scope of the
   previous \verb+\cutdef+. The cutting unit and cutting depth are
   restored.
   Note that \verb+\cutdef+ and \verb+\cutend+ must be properly balanced.
\end{description}

\noindent Default settings work as follows:
\verb+\begin{document}+ performs
\begin{verbatim}
\cutdef[\value{cuttingdepth}]{\cuttingunit}
\end{verbatim}
and \verb+\end{document}+
performs \verb+\cutend+.
All sectioning commands down to \verb+\subsubsection+ perform \verb+\cuthere+,
with the sectional unit name as first argument and the (optional, if
present) sectioning
command argument (i.e., the section title) as second argument.
Note that started versions of the sectioning commands also perform
cutting instructions.

\subsubsection{Examples}

Consider, for instance, a \filename{book} document with a long chapter
that you want to cut at the section level, showing subsections:
\begin{verbatim}
\chapter{A long chapter}
.....

\chapter{The next chapter}
\end{verbatim}
Then, you should insert a \verb+\cutdef+ at chapter start and a
\verb+\cutend+ at chapter end:
\begin{verbatim}
\chapter{A long chapter}
%HEVEA\cutdef[1]{section}
.....
%HEVEA\cutend
\chapter{The next chapter}
\end{verbatim}
The macro \verb+section+ already performs the appropriate
\verb+\cuthere{section}{...}+ commands. As a consequence, the file
that would otherwise contain the long chapter now contains the chapter
title and a table of sections.
(Also note that cutting macros are placed inside \verb+%HEVEA+ comments,
for \LaTeX{} not to be disturbed).

The \verb+\cuthere+ macro can be used to put some document parts into
their own file.
This may prove appropriate for long cover pages or abstracts that would
otherwise go into the root file.
Consider the following document:
\begin{verbatim}
\documentclass{article}

\begin{document}

\begin{abstract} A big abstract \end{abstract}
...
\end{verbatim}

Then, you make the abstract go to its own file as it was a cutting
unit by typing:
\begin{verbatim}
\documentclass{article}
\usepackage{html}

\begin{document}
\cuthere{\cuttingunit}{Abstract}
\begin{abstract} A big abstract \end{abstract}
...
\end{verbatim}
(Note that, this time, cutting macros appear unprotected in the
source. However, \LaTeX{} still can process the document, since the
\texttt{html} package is loaded).

\setcounter{section}{0}
\renewcommand{\thesection}{\thepart.\arabic{section}}
\part{Reference manual}\label{referencemanual}


This part follows the pattern of the \LaTeX{} reference
manual~\cite[Appendix~C]{latex}.

\section{Commands and Environments}

\subsection{Command Names and Arguments}

\LaTeX{} comments, that start with ``\verb+%+'' %
and end at end of line are ignored and produce no output.

Command names follow strict \LaTeX{} syntax. That is, apart from
\verb+#+, \verb+$+, %$
\verb+~+, \verb+_+ and \verb+^+, they either are
``\verb+\+'' followed by a single non-letter character or
``\verb+\+'' followed by a sequence of letters.
Additionally, the letter sequence may either be preceded by ``\verb+@+''
(and this is the case of many of \hevea{} internal commands), or
terminated by ``\verb+*+'' (starred variants are implemented as plain
commands).

Users are strongly advised to follow strict \LaTeX{} syntax for
arguments. That is, mandatory arguments are enclosed in curly braces
\verb+{+\ldots{} \verb+}+ and braces inside arguments must be properly
balanced.
Optional arguments are enclosed in square brackets \verb+[+\ldots{}
\verb+]+.
However, \hevea{} does its best to read arguments even when they are
not enclosed in curly braces.
Such arguments are a single, different from ``\verb+\+'', ``\verb+{+''
and ``\verb+ +'', character or
a command name.
Thus, constructs such as \verb+\'ecole+, \verb+$a_1$+ or \verb+$a_\Gamma$+ are
recognized and processed as ``\'ecole'' ``$a_1$'' and ``$a_\Gamma$''.
Note that, by contrast with \LaTeX{}, comments are parsed during
argument scanning, as an important consequence brace nesting is also
checked inside comments.

\subsection{Environments}

Environment opening and closing is performed like in \LaTeX{}, with
\verb+\begin{+\textit{env}\verb+}+ and
\verb+\end{+\textit{env}\verb+}+.
The \verb+*+-form of an environment is a plain environment.

\subsection{Fragile Commands}
Fragile commands are not relevant to \hevea{} and \verb+\protect+ is
defined as a null command.

\subsection{Declarations}
Scope rules are the same as in \LaTeX.

\subsection{Invisible Commands}
I am a bit lost here. However spaces in the output should correspond
to users expectations. Note that, to \hevea{} being
invisible commands is a static property attached to command name.

\subsection{The \texttt{\char92\char92} Command}

The \verb+\\+ and \verb+\\*+ commands are the same, they perform a
line break, except inside arrays where they end the current row.
Optional arguments to \verb+\\+ and \verb+\\*+ are ignored.


\section{The Structure of the Document}

Only text after \verb+\begin{document}+ and before
\verb+\end{document}+ is translated to \html{}.
However, source that occurs before \verb+\begin{document}+ is
processed
(this comprises the content of the files given as command line
arguments to \hevea{}, see section~\ref{heveausage}).
As a consequence, command and environment  definitions that
occur  before \verb+\begin{document}+ are performed.


In particular, it is possible to change \hevea{} default argument
to the opening \verb+<HTML>+ and \verb+<BODY>+ tags by redefining
\verb+\@htmlargs+ and \verb+\@bodyargs+.
For instance, you get black text on a white background, when the
following declaration occurs before \verb+\begin{document}+:
\begin{verbatim}
\renewcommand{\@bodyargs}{TEXT=black BGCOLOR=white}
\end{verbatim}


\section{Sentences and Paragraphs}

\subsection{Spacing}
Generally speaking, spaces (and single newline characters) in the
source are echoed in the output.  Browser then manage with spaces and
line-breaks.  Following \LaTeX{} behavior, spaces after commands are
not echoed.  Spaces after invisible commands with arguments are not
echoed either.


However this is no longer true in math mode, see
section~\ref{spacemathref} on spaces in math mode.


\subsection{Paragraphs}
New paragraphs are introduced by one blank line or more.
Paragraphs are not indented. Thus the macros \verb+\indent+ and
\verb+\noindent+ perform no action.

\subsection{Footnotes}
The commands \verb+\footnote+,
\verb+\footnotetext+ and \verb+\footnotemark+ (with or without
optional arguments) are supported.
The \verb+footnote+ counter exists and (re)setting it or redefining
\verb+\thefootnote+ should work properly.

Footnotes appear at document end in the \filename{article} style and
at every chapter end in the \filename{book} style.
If the document is then cut into smaller files by \hacha{} (see
section~\ref{hacha}) footnotes may go to a separate file.

Footnotes are bad.
If you want to suppress them, redefine \verb+\footnote+ as follows:
\begin{verbatim}
\renewcommand{\footnote}[2][]{}
\end{verbatim}
If you want to put then in the text flow,  redefine \verb+\footnote+
as follows:
\begin{verbatim}
\renewcommand{\footnote}[2][]{~(#2)}
\end{verbatim}

\subsection{Accents and special symbols}
When there exists an equivalent to a given \LaTeX{} symbol, using
the iso-latin1 and symbol character sets, then \hevea{}
outputs such an equivalent.
\html{} pages that show these character sets can be found
here in the directory \texttt{\docurl/doc/}
at \url{iso.html}{\texttt{iso.html}} and
\url{symbol.html}{\texttt{symbol.html}}.
Otherwise, \hevea{} usually issues a warning to draw user attention.
Users can then choose their own equivalent for the symbol.

Commands for making accents used in non-English languages, such as
\verb+\'+, work when then produce letters from the iso-latin1 character set.
Otherwise, the argument to the command is not modified (no warning here).
However, it is more simple to write the document using iso-latin1.
\LaTeX{} can process such documents by loading the package
\texttt{isolatin1}.

\section{Sectioning}

\subsection{Sectioning commands}
Sectioning commands from \verb+\part+ down to
\verb+\subparagraph+ are defined in base style files.
They accept an optional argument and have starred versions.


The non-starred sectioning commands from \verb+\part+ down to
\verb+\subsubsection+ show section numbers in sectional unit headings.
This behavior cannot be changed and the \verb+secnumdepth+ counter
does not exist.  However, given a sectional unit {\it secname}, the
counter {\it secname} exists and the appearance of sectional units
numbers can be changed by redefining \verb+\the+{\it secname}.


\subsection{The Appendix}
The \verb+\appendix+ command exists and should work as in \LaTeX.

\subsection{Table of Contents}
\hevea{} does not generate a table of contents and all table of contents
related commands such as \verb+\tableofcontents+ or
\verb+\addcontentsline+ do nothing.

However, a later run of {\hacha} on \hevea{} output file splits it
in smaller files organized in a tree whose nodes are tables of
links.
By contrast with \LaTeX{}, starred sectioning commands generate
entries in these tables of contents.
Table of content entries hold the optional argument to sectioning
commands or their argument when there is no optional
argument. Section~\ref{hacha} explains how to
control {\hacha}.

There is no list of figures nor list of tables.

\section{Classes, Packages and Page Styles}

\subsection{Document Class}
Both \LaTeXe{} \verb+\documentclass+ and old \LaTeX{}
\verb+\documentstyle+ are accepted.
Their argument \filename{style} is interpreted by attempting to load a
\filename{style}\texttt{.hva} file (see~\ref{heveausage} to see where \hevea{}
searches its files).
Presently, only the style files \texttt{article.hva}, \texttt{seminar.hva},
\texttt{book.hva} and \texttt{report.hva} exist, the latter two
being the same file.

If one of the four styles has already been loaded at the time when
\verb+\documentclass+ or
\verb+\documentstyle+ is executed, then no attempt to load a style
file is made. This allows to override the document style file by
giving one of the four recognized style files of \hevea{} as command line arguments.

\subsection{Packages and Page Styles}
They are ignored. Related commands do nothing.
As a consequence, style files that are relevant to \hevea{} should be
loaded using the \verb+\input+ command.
Note, however, \verb+\usepackage+ commands are echoed to the \filename{image}
file (see~\ref{imagen}).

\subsection{The Title Page and Abstract}
All title related commands exist, with the following peculiarities:
\begin{itemize}
  \item The \verb+\title+ command must appear in the preamble for the title
to appear in \html{} document header.
  \item When not present the date is left empty. The \verb+\today+
command generates an empty date.
\end{itemize}

The \verb+abstract+ environment is present is all base styles,
including the \filename{book} style.
The \verb+titlepage+ environment does nothing.

\section{Displayed Paragraphs}
Displayed-paragraph environments translate to block-level
\html-elements.

\subsection{Quotation and Verse}
The \verb+quote+ and \verb+quotation+ are the same thing: they
translate to \verb+<BLOCKQUOTE>+ elements.
The \verb+verse+ environment is not supported.

\subsection{List-Making environments}
The \verb+itemize+, \verb+enumerate+ and \verb+description+
environments translate to the \verb+<UL>+, \verb+<OL>+, and
\verb+<DL>+ elements.
There is no control over the default item labels in an \verb+itemize+
or on numbering in a \verb+enumerate+ environment. The
\verb+\labelitemi+\ldots commands and \verb+enumi+\ldots  counters are
not defined.

\subsection{The \protect\texttt{list} and \protect\texttt{trivlist}
environments}
The \verb+list+ environment translates to the
\verb+<DD COMPACT=compact>+ element.
Arguments to \verb+\begin{list}+ are handled as follows:

\begin{flushleft}
\quad\verb+\begin{list}{+{\it default\_label}\verb+}{+{\it decls}\verb+}+
\end{flushleft}

The first argument {\it default\_label} is the label generated by an
\verb+\item+ command with no argument.
The second argument, {\it decls} is a sequence of declarations.
In practice, the following declarations are useful:
\begin{list}{}{}
\item[\texttt{\char92 usecounter\{}\textit{counter}\texttt{\}}]
The counter {\it counter} is incremented by \verb+\refstepcounter+
before every \verb+\item+ command with no argument.
\item[\texttt{\char92 renewcommand\{\char92
makelabel\}[1]\{}\ldots\texttt{\}}]
The command \verb+\item+ executes
\verb+\makelabel{+{\it label}\verb+}+, where {\it label} is the item
label, to print its label.
Thus, users can change label formatting by redefining
\verb+\makelabel+.
The default defining of \verb+\makelabel+ simply processes {\it
label}.
\end{list}

As an example, lists with user-defined counter can be defined as
follows:
\begin{verbatim}
\newcounter{coucou}
\begin{list}{\thecoucou}{%
\usecounter{coucou}%
\renewcommand{\makelabel}[1]{\textbf{#1}.}}
...
\end{list}
\end{verbatim}
This yields:
\newcounter{coucou}
\begin{list}
  {\thecoucou}
  {\usecounter{coucou}\renewcommand{\makelabel}[1]{\textbf{#1}.}}
\item First item.
\item Second item.
\end{list}


The \verb+trivlist+ environment is also supported. It translates to a
\verb+<DL>+ element.

\subsection{Verbatim}

The \verb+verbatim+ and \verb+verbatim*+ environments translate to
the \verb+<PRE>+ element. There is no difference between
\verb+verbatim+ and \verb+verbatim*+.

Similarly, \verb+\verb+ and \verb+\verb*+ are the same and they
translate to the \verb+<CODE>+ text element.

The \verb+alltt+ environment is supported, but no extensive testing of
it has yet been performed. Surprises are likely.

\section{Mathematical Formulas}

\subsection{Math Mode Environment}
The three ways to use math mode (\verb+$+\ldots\verb+$+,
\verb+\(+\ldots\verb+\)+ and
\verb+\begin{math}+\ldots\verb+\end{math}+) are supported.
The three ways to use display math mode (\verb+$$+\ldots\verb+$$+,
\verb+\[+\ldots\verb+\]+ and
\verb+\begin{displaymath}+\ldots\ \verb+\end{displaymath}+) are also
supported.
Furthermore, \verb+\ensuremath+ behaves as expected.


The \verb+equation+, \verb+eqnarray+, \verb+eqnarray*+ environments
are supported.
Equation labeling and numbering is performed in the first two
environments, using the \verb+equation+ counter.
Additionally, numbering can be suppressed in one row of an
\verb+eqnarray+, using the \verb+\nonumber+ command.


Math mode is not as powerful in \hevea{} as in \LaTeX{}.  The
limitations of math mode can often be surpassed by using math display
mode.  As a matter of fact, math mode is for in-text formulas. From
the \html{} point of view, this means that math mode does not close
the current flow of text and that formulas in math mode must be
rendered using text-level elements only.  By contrast, displayed
formulas can be rendered using block-level elements.  This means that
\hevea{} have much more possibilities in display context than inside
normal flow of text.  In particular, stacking text elements one above
the over is possible only in display context.
\begin{htmlonly}
For instance compare how \hevea{} renders
\verb+$\frac{1}{\sum_{i=1}^{\infty}$+
as: $\frac{1}{\sum_{i=1}^{\infty} i^i}$, and 
\verb+$$\frac{1}{\sum_{i=1}^{\infty}$$+ as:
$$\frac{1}{\sum_{i=1}^{\infty} i^i}$$
\end{htmlonly}


\subsection{Common Structures}

\hevea{} admits, subscript (\verb+_+), superscripts (\verb+^+) and
fractions (\verb+\frac{+{\it numer}\verb+}{+{\it denom}\verb+}+).
The best effect is obtained in display mode, where \html{}
\verb+<TABLE>+ element is extensively used. However, in-text
simple subscript and superscript are rendered using the \verb+<SUB>+
and \verb+<SUP>+ text-level elements and their appearance should be correct
both in in-text and displayed  formulas.

The n$^{\mbox{th}}$ root command \verb+\sqrt+ is not supported.


An attempt is made to render all ellipsis constructs (\verb+\ldots+,
\verb+\cdots+, \verb+\vdots+ and \verb+\ddots+). The effect may be
strange for the latter two.

\subsection{Mathematical symbols}
Symbols that can be printed using browser iso-latin1 or symbol fonts
are translated.
Other symbols are undefined most of the time.
Attempting to translate them will thus generate ``Unknown macro''
warnings.
Then, users can choose their own replacement for these symbols.
These personal definitions are best placed in an ad-hoc style file,
given as a command line argument to \hevea{}.
A suggested replacement is a mix of colors and available
symbols.
\begin{htmlonly}
For instance, \hevea{} cannot render the \verb+\leadsto+ symbol, but it
can be defined as a red arrow  by:
\begin{verbatim}
\newcommand{\leadsto}{{\red\rightarrow}}
\end{verbatim}
Then, \verb+$$A \leadsto B$$+ is rendered as follows:
$$\newcommand{\leadsto}{{\red\rightarrow}}
A \leadsto B
$$
\end{htmlonly}

When given the \verb+-nosymb+ option, \hevea{} silently replaces
symbols that cannot be rendered by iso-latin1 only by text equivalents.
These equivalents are English words by default, or French words when the
\verb+-francais+ option is set.

Log-like functions and variable sized-symbols are recognized and their
subscripts and superscripts are put where they should in display mode.
Subscript and superscript placement can be changed using the
\verb+\limits+ and \verb+\nolimits+ commands.
Big delimiters are also handled.

\subsection{Putting one thing above the other}
The commands \verb+\stackrel+,  \verb+\underline+ and \verb+\overline+
are recognized.
They produce sensible output in display mode.
In text mode, these macros call the \verb+\textstackrel+,
\verb+\textunderline+ and \verb+\textoverline+ macros.
These macros perform the following default actions, which can be
changed by redefining them:
\begin{description}
\item[\texttt{\char92 textstackrel}] Performs ordinary superscripting.
\item[\texttt{\char92 textunderline}] Underlines its argument, using the
\html{} \verb+<U>+ text-level element.
\item[\texttt{\char92 textoverline}] Sends a warning message to the
console and echoes its argument in the output.
\end{description}

Math accents (\verb+\hat+, \verb+\tilde+, etc.) are not handled at
all.

\subsection{Spacing}\label{spacemathref}
By contrast with \LaTeX{}, space in the input matters in math mode.
One or more spaces are translated to one space.
Furthermore,
spaces after commands (such as \verb+\alpha+) are echoed
except for invisible commands (such as \verb+\tt+).
This allows users to control space in their formulas, output being
near to what can be expected.


Explicit spacing commands (\verb+\,+, \verb+\!+, \verb+\:+ and
\verb+\;+) are recognized, the first two commands do nothing, while
the others two output one space.

\subsection{Changing Style}

Letters are always italicized inside math mode and this cannot be
changed. The appearance of
other symbols can be changed using
\LaTeXe{} style changing commands (\verb+\mathrm+, etc.).
The commands \verb+\boldmath+ and \verb+\unboldmath+ are not
recognized. Whether symbols belonging to the symbol font are affected
by these changes or not is browser dependent.

Observe that this does not corresponds directly to how \LaTeX{} manage style
in maths.

Math style changing declarations \verb+\displaysyle+ and \verb+\textstyle+
do not exist, while \verb+\scriptstyle+ and \verb+\scriptscriptstyle+
perform type size changes.

\section{Definitions, Numbering}

\subsection{Defining Commands}\label{usermacro}

\hevea{} understands command definitions given in \LaTeX{} style. Such
definitions are made using
\verb+\newcommand+, \verb+\renewcommand+ and \verb+\providecommand+.
These three constructs accept the same arguments and have the same
meaning as in \LaTeX{}. However, \hevea{} is more tolerant: if macro
{\it name} already exists, then a subsequent \verb+\newcommand{+{\it
name}\verb+}+ is ignored.  If macro {\it name} does not exists, then
\verb+\renewcommand{+{\it name}\verb+}+ performs a definition of {\it
name}.  In both cases, warnings are issued.

The behavior of \verb+\newcommand+ allows to shadow document
definition, provided the new definitions are processed before the
document definitions.
This is easily done by grouping the shadowing definition  in a
specific style file given as an argument to \hevea{}.
By contrast, changes of base macros (i.e., the ones that \hevea{}
defines before loading any user-specified file) must be performed
using \verb+\renewcommand+. Such personal (re)-definition can be made
in any user file.


\hevea{} also accepts simple {\TeX} style (using \verb+\def#1#2...+
without delimiting 
characters), with the same behavior as \verb+\newcommand+.
It is important to notice that \hevea{} semantics for \verb+\def+
departs significantly from \TeX{} semantics. In particular, defining a
command that already exists with \verb+\def+ fails in \hevea{},
whereas it succeeds in \TeX{}.
Users are thus invited to use \LaTeX{} \verb+\renewcommand+ for the purpose
of redefining commands.

\hevea{} also processes a
limited version of \verb+\let+:
\begin{flushleft}
\verb+\let+ {\it macro-name} \verb+=+ {\it macro-name}
\end{flushleft}

Scoping rules apply to macros, as they do in \LaTeX{}.
You can escape them by using the {\TeX} constructs
\verb+\gdef+, \verb+\global\def+ and \verb+\global\let+


\subsection{Defining Environments}
\hevea{} accepts environment definitions and redefinitions
by \verb+\newenvironment+ and \verb+\renewenvironment+.
New theorem-like environments can also be introduced and redefined,
using \verb+\newtheorem+ and \verb+\renewtheorem+.
The support is complete and should conform
to~\cite[Sections~C.8.2 and~C.8.3]{latex}.

Note that environments are local to the block
they are defined into,
while  theorem-like environment definitions  are global.

\subsection{Numbering}
\LaTeX{} counters are (fully ?) supported.
In particular, defining a counter \textit{cmd} with
\verb+\newcounter{+\textit{cmd}\verb+}+ creates a macro
\verb+\the+\textit{cmd} that outputs the counter value.
Then the \verb+\the+\textit{cmd} command can be redefined.
For instance, section numbering can be turned into alphabetic style by:
\begin{verbatim}
\renewcommand{\thesection}{\alph{section}}
\end{verbatim}

Note that \TeX{} style for counters is not supported at all and that using
this style
will clobber the output.

\section{Figures and Other Floating Bodies}

Figures and tables are put where they appear in source, regardless of
their placement arguments.
They are outputed  inside a \verb+<BLOCKQUOTE>+ element and they are
separated from enclosing text by two
horizontal rules.

Captions and cross referencing are handled.
The \verb+\suppressfloats+ command does nothing and the
figure related counters (such as \verb+topnumber+) exist but are useless.

Marginal notes are not handled and the \verb+\marginpar+ command does
not exist.
If their document holds \verb+\marginpar+ command, users should define
it as a null command~:
\begin{verbatim}
\newcommand{\marginpar}[1]{}
\end{verbatim}

\section{Lining It Up in Columns}
\subsection{The \protect\texttt{tabbing} Environment}
Limited support is offered.
The \texttt{tabbing} environment translate to a flexible \texttt{tabular}-like
environment.
Inside this environment, the command \verb+\kill+ ends a row, while
commands
\verb+\=+ and \verb+\>+ start a new column.
All other tabbing commands do not even exist.

\subsection{The \protect\texttt{array} and \protect\texttt{tabular}
environments}

These environments are partially supported, using \html{}
\verb+<TABLE>+, however rendering is
satisfactory in most (simple) cases.
Arrays can nest. By contrast with \LaTeX{}, arrays implicitly open
display mode and array items are typeset in display mode.



Some \LaTeX{} array features are not supported at all:
\begin{itemize}
\item Optional arguments to \verb+\begin{array}+ and
\verb+\begin{tabular}+ are ignored.
\item The command \verb+\vline+ does not exists.
\end{itemize}

Some others are partly rendered:
\begin{itemize}
\item Spacing between columns is different. In particular, some space
appears around \verb+@+~formatting specification.
\item \verb+@+ formatting specifications in \verb+\multicolumn+
argument are ignored.
\item The \verb+p{+{\it wd}\verb+}+ column specification is equivalent
to \verb+l+ with word wrap enabled. This is the only occasion where
\hevea{} makes a distinction between LR-mode and paragraph mode.
The length arguments to \verb+p+ specifications are ignored.
\item If a \verb+|+ appears somewhere in the column formatting
specification, then the array is shown with borders.
\item The command \verb+\hline+ does nothing if the array has borders
(see above). Otherwise, an horizontal rule is outputed.
\item The command \verb+\cline+ ignores its argument and is equivalent
to \verb+\hline+.
\item The \verb+tabular*+ environment is rendered as an ordinary
\verb+tabular+.
(A warning is issued).
Its first argument is ignored.
\item Similarly the command
\verb+\extracolsep+ issues a warning and ignores its argument.
\end{itemize}

There is an additional feature: if ``\verb+t+'' appears before a
column format (\verb+c+, \verb+l+ or \verb+r+), then the corresponding
column is typeset after exiting math-mode.
This additional feature enables the encoding of \TeX{} \verb+\cases+ using
the \LaTeX{} arrays.
The command \verb+\cases+ is defined in \texttt{hevea.hva}.

\section{Moving Information Around}
\subsection{Files}\label{files}
\hevea{} can use some of the ancillary files generated by \LaTeX{} in
order to output better looking cross-references.
In practice, while processing file \filename{mydoc}\texttt{.tex}, the following
files may be read:
\begin{description}
\item[\protect\texttt{.aux}] The file \filename{mydoc}\texttt{.aux} contains
cross-referencing informations, such as figure or section numbers.
If this file is present, \hevea{} reads it and put such numbers (or
labels) inside
the links generated by the \verb+\ref+ command. If the \texttt{.aux}
file is not present, all such numbers are
replaced by ``X''.
\item[\protect\texttt{.bbl}] The file \filename{mydoc}\texttt{.bbl} is generated by
\BibTeX{}. It is read by the \verb+\bibliography+ command.
\item[\protect\texttt{.idx}] The file \filename{mydoc}\texttt{.idx} is
normally not
read by \hevea{}, which does its own index computations.
Some user modify \filename{.idx} files before running
\verb+makeindex+, for instance to sort index entries taking
non-English diacritics into account.
\hevea{} can read such files and use the index entry labels they define,
provided it is given the \verb+-idx+ option.
Thus, if you follow such a scheme on \filename{mydoc}\texttt{.tex}, first run
\LaTeX{}, process \filename{mydoc}\texttt{.idx} and invoke \hevea{} with the
\verb+-idx+ option set.
\end{description}

\noindent\hevea{} does not fail when it cannot find an auxiliary file.

\subsection{Cross-References}
The \LaTeX{} \verb+\label+ and \verb+\ref+ are changed by \hevea{}
into {\html} anchors and local links.
Additionally, numerical references to sectional units, figures,
tables, etc. are shown, as they would appear in the \texttt{.dvi} file,
provided a \texttt{.aux} file exists.
Numerical references to pages (such as generated by \verb+\pageref+)
are not shown; only an link is generated.

Thus, to get the cross references right in a document,
\filename{mydoc.tex}, you should first generate an 
up-to-date \filename{mydoc.aux} file by running \LaTeX{} as many times
as necessary.
If no \filename{mydoc.aux} exists,  all references are shown as
``X''.
If a non-correct \filename{mydoc.aux} file is present, then cross
references will apparently be wrong. However the links are correct in
both cases.

\subsection{Bibliography and Citations}
The \verb+\cite+ macro is supported. Its optional argument is
correctly handled. Citation labels are extracted from the
\texttt{.aux} file, if present. Otherwise the argument to
\verb+cite+ is used.

The \verb+\bibliography+ command is
recognized, it loads the \texttt{.bbl} file which should thus
have been generated before, using the appropriate combination of
\LaTeX{} and \BibTeX{} runs.

The \verb+thebibliography+ environment is recognized.

The \verb+\nocite+ and \verb+\bibliographystyle+ macros exist and do
nothing.

\subsection{Splitting the Input}

The \verb+\input+ and \verb+\include+ commands exist and they perform
exactly the same operation of searching a file.
Given \filename{filename}, an the argument to \verb+\input+ or
\verb+\include+,
a file is searched as follows:
\begin{itemize}
\item If \filename{filename} is an absolute path, then \hevea{}
attempt to open a file with this name exactly.
\item Otherwise, \hevea{} searches a file with name
\filename{filename} in all the directories in its search path.
\end{itemize}
Additionally, if \filename{filename}
does not have an
extension and that a first attempt to find it fails, then a second
attempt is made, looking for file \filename{filename}\texttt{.tex}.

The search path starts with the current directory ``\texttt{.}'' and
ends with \hevea{} installation directory.
Users can modify the search path by using command lines options and
the \texttt{HEVEADIR} shell variable, see section~\ref{heveausage}.


The \verb+\includeonly+ command is supported, while the
\verb+\listfiles+ command is a null command.


\subsection{Index and Glossary}\label{index}
\hevea{} supports several simultaneous indexes, following the scheme
of the
\footurl{ftp://theory.lcs.mit.edu//pub/tex/index/}{\filename{index}} style,
which is present in modern \LaTeX{} distributions.
This scheme is backward compatible with the standard indexing scheme
of \LaTeX.
Observe that \hevea{} does its own index computation  and does not need
\verb+makeindex+.

More precisely, \hevea{} knows the following commands:
\begin{description}
\item[{\tt\char92 newindex\{}{\it tag}{\tt \}\{}{\it
ext}{\tt\}\{}{\it ignored}{\tt\}\{}{\it indexname}{\tt\}}]
Declare an index.
The first argument {\it tag} is a tag to select this index in other
commands; {\it ext} is the extension of the index information file
generated by \LaTeX{} (e.g., \texttt{idx}); {\it ignored} is ignored by
\hevea{}; and {\it indexname} is the title of the index.
If given the \verb+idx+ option. \hevea{} attempts to read file
\filename{mydoc}\texttt{.}{\it ext}. There also exists a
\verb+\renewindex+ commands that takes the same arguments and that can be
used to redefine previously declared indexes.
\item[{\tt\char92 makeindex}] Perform
\verb+\newindex{default}{idx}{ind}{Index}+.
\item[{\tt\char92 index[}{\it tag}{\tt]\{}{\it arg}{\tt\}}]
Act as the \LaTeX{} \verb+\index+ command except that the information
extracted from {\it arg} goes to the {\it tag} index.
The {\it tag} argument defaults to \verb+default+, thereby yielding
standard \LaTeX{} behavior for the \verb+\index+ command without an
optional argument.
There also exists a stared-variant \verb+\index*+ that Additionally
typesets {\it arg}.
\end{description}

Glossaries are not handled (who uses them ?) and the \verb+theindex+
environment does not 
exist (since \hevea{} computes its own indexes).

\subsection{Terminal Input and Output}

The \verb+\typeout+ command echos its argument verbatim on the
terminal.
The \verb+\typein+ command is not supported.

\section{Line and Page Breaking}

\subsection{Line Breaking}
The advisory line breaking commands \verb+\linebreak+ and
\verb+\nolinebreak+ are null commands.

The \verb+\\+ and \verb+\\*+ commands output a \verb+<BR>+ element,
except inside arrays where the close the current row.
Their optional argument is ignored.
The \verb+\newline+ command outputs a \verb+<BR>+ element.

All other line breaking commands, declarations or environments are
silently ignored.

\subsection{Page Breaking}
They are no pages in the physical sense in \html. Thus, all these
commands are ignored.

\section{Lengths, Spaces and Boxes}

\subsection{Length}

All length commands are ignored, things go smoothly when \LaTeX{} syntax is
used (using the \verb+\newlength+, \verb+\setlength+, etc. commands,
which are null macros).
Of course, if lengths are really important to the document, rendering
will be poor.

Note that \TeX{} length syntax is not at all recognized. As a
consequence, writing things like \verb+\textwidth=10cm+ will clobber
the output.
Users can correct such misbehavior by adopting \LaTeX{} syntax, here
they should write
\verb+\setlength{\textwidth}{10cm}+.


\subsection{Space}\label{spaces}

The \verb+\hspace+, \verb+\vspace+ and \verb+\addvspace+ spacing
commands and their starred versions recognize positive explicit length
arguments.  Such arguments get converted to a number of non-breaking
spaces or line breaks.
Basically, the value of \verb+1em+ or \verb+1ex+ is one space or one
line-break. For other length units, a simple conversion based upon a
12pt font is used.


\hevea{} cannot interpret more complicated length arguments
or perform negative spacing.
In these situations, a warning is issued and no output is done.

Spacing commands without arguments are recognized.
The \verb+\enspace+, \verb+\quad+ and \verb+\qquad+ commands output
one, two and four non-breaking spaces, while the \verb+\smallskip+,
\verb+\medskip+ and \verb+\bigskip+ output one, one, and two line
breaks.

Stretchable lengths do not exist, thus the \verb+\hfill+ and
\verb+\vfill+ macros are undefined.

\subsection{Boxes}

Box contents is typeset in text mode (i.e., non-math and non-display
mode).
Both \LaTeX{} boxing commands \verb+\mbox+ and \verb+\makebox+
commands exist.
However  \verb+\makebox+ generates a specific warning, since \hevea{}
ignore the length and positioning instructions given as optional
argument.

Similarly, the boxing with frame \verb+\fbox+ and \verb+\framebox+
commands are recognized and
\verb+\framebox+ issues a warning.
When in display mode, \verb+\fbox+ frames its argument by
enclosing it in a
table with borders. Otherwise, \verb+\fbox+ calls the \verb+\textfbox+
command, which issues a warning and typesets its argument
inside a \verb+\mbox+ (and thus no frame is drawn).
Users can alter the behavior of \verb+\fbox+ in non-display mode by
redefining \verb+\textfbox+.



Boxes can be saved for latter usage by storing them in {\em bins}.
New bins are defined by \verb+\newsavebox{+{\it cmd}\verb+}+.

Then some text can be saved into {\it cmd} by
\verb+\sbox{+{\it text}\verb+}{+{\it cmd}\verb+}+.
The text is translated to \html{}, as if it was inside a \verb+\mbox+
and the resulting output is stored.
It is retrieved (and outputed) by the command
\verb+\usebox{+{\it cmd}\verb+}+.
The \verb+\savebox+ command reduces to \verb+\sbox+, ignoring its
optional arguments.

The \verb+\rule+ commands translate to a \html{} horizontal rule
(\verb+<HR>+)  regardless of its arguments.


All other box-related commands do not exist.

\section{Pictures and Colors}

\subsection{The \texttt{picture} environment and the \texttt{graphics}
Package}
At the moment (version~\heveaversion), \hevea{} knows nothing about
the \texttt{picture} environment and the \texttt{graphics} package.
However, it is possible to have pictures and graphics processed by
\texttt{imagen} 
and to include links to resulting \texttt{gif} images (see
section~\ref{imagen}).
For instance consider the following picture:
\begin{verbatim}
\newcounter{cms}
\setlength{\unitlength}{1mm}
\begin{picture}(50,10)
\put(0,7){\makebox(0,0)[b]{cm}}
\multiput(10,7)(10,0){5}{\addtocounter{cms}{1}\makebox(0,0)[b]{\arabic{cms}}}
\multiput(1,0)(1,0){49}{\line(0,1){2.5}}
\multiput(5,0)(10,0){5}{\line(0,1){5}}
\thicklines
\put(0,0){\line(1,0){50}}
\multiput(0,0)(10,0){6}{\line(0,1){5}}
\end{picture}
\end{verbatim}
Users should enclose {\em all} picture elements in a \verb+toimage+
environment and insert an \verb+\imageflush+ command, where they want
the image to appear in \html{} output:
\begin{verbatim}
%BEGIN IMAGE
\newcounter{cms}
\setlength{\unitlength}{1mm}
\begin{picture}(50,10)
  ...
\end{picture}
%END IMAGE
%HEVEA\imageflush
\end{verbatim}
This will result in normal processing by \LaTeX{} and image inclusion
by \hevea~:

%BEGIN IMAGE
\newcounter{cms}
\setlength{\unitlength}{1mm}
\begin{picture}(50,10)
\put(0,7){\makebox(0,0)[b]{cm}}
\multiput(10,7)(10,0){5}{\addtocounter
  {cms}{1}\makebox(0,0)[b]{\arabic{cms}}}
\multiput(1,0)(1,0){49}{\line(0,1){2.5}}
\multiput(5,0)(10,0){5}{\line(0,1){5}}
\thicklines
\put(0,0){\line(1,0){50}}
\multiput(0,0)(10,0){6}{\line(0,1){5}}
\end{picture}
%END IMAGE
%HEVEA\imageflush


\subsection{The \texttt{color} Package}\label{color}
\newcommand{\showcolor}[1]{\texttt{#1}}

\hevea{} partly implements the \texttt{color} package.
Implemented commands are \verb+\definecolor+, \verb+\color+ and
\verb+\textcolor+. Other commands from the \texttt{color} package do
not exist.
At startup,
colors \showcolor{black}, \showcolor{white},
\showcolor{red}, \showcolor{green}, \showcolor{blue},
\showcolor{cyan}, \showcolor{yellow} and \showcolor{magenta} are
pre-defined.




\section{Font Selection}

\subsection{Changing the Type Style}
All \LaTeXe{} declarations and environments for changing type style
are recognized. Aspect is rather like \LaTeXe{} output, but there is
no guarantee.
Old style declarations are also recognized, they
should yield the same
appearance as corresponding new declarations.

\hevea{} possesses an extra font attribute: color.
Text color is changed by declarations whose names follow \html{}
conventions for colors.
There are sixteen predefined colors:
\begin{center}
\begin{tabular}{p{.7\linewidth}}
%HEVEA\purple
\verb+\purple+,
%HEVEA\silver
\verb+\silver+,
%HEVEA\gray
\verb+\gray+,
%HEVEA\white
\verb+\white+,
%HEVEA\maroon
\verb+\maroon+,
%HEVEA\red
\verb+\red+,
%HEVEA\fuchsia
\verb+\fuchsia+,
%HEVEA\green
\verb+\green+,
%HEVEA\lime
\verb+\lime+,
%HEVEA\olive
\verb+\olive+,
%HEVEA\yellow
\verb+\yellow+,
%HEVEA\navy
\verb+\navy+,
%HEVEA\blue
\verb+\blue+,
%HEVEA\teal
\verb+\teal+,
%HEVEA\aqua
\verb+\aqua+
\end{tabular}
\end{center}
Additionally, the current text color can be changed by the declaration
\verb+\htmlcolor{+{\it number}\verb+}+, where {\it number} is a six
digit hexadecimal number specifying a color in the RGB space.
For instance, the following declarations change font color to dark gray:
%HEVEA{\htmlcolor{404040}%
\begin{verbatim}
  \htmlcolor{404040}
\end{verbatim}
%HEVEA}

Text colors can also be specified in a more \LaTeX{}-compliant manner
by using commands from the \texttt{color} package, which \hevea{}
partly implements (see section~\ref{color}).
Colors should be used carefully. Too many colors
hinders clarity and some of the colors may not be readable on the
document background color.

\subsection{Changing the Type Size}
All declarations, from \verb+\tiny+ to \verb+\Huge+ are recognized.
Output is not satisfactory inside headers elements
generated by sectioning commands.

\subsection{Special Symbols}

The \verb+\symbol{+{\it num}\verb+}+ outputs character number {\it num}
from the iso-latin1 character set.
This departs from \LaTeX{}, which output symbol number \textit{num} in
the current font.

\section{Extra Features}
This section describes \hevea{} functionalities that extends on plain \LaTeX{},
as defined in \cite{latex}.

\subsection{\TeX{} Conditional Macros}
Normally, \hevea{} does not recognize constructs that are specific to
\TeX{}, in the sense that they are not described in the \LaTeX{}
manual.
However \hevea{} recognizes \`a la \TeX{} conditional macros.
The \verb+\newif+\textit{name}, where \textit{name} is made of letters
only, creates three macros:
\verb+\if+\textit{name}, \verb+\+\textit{name}\texttt{true} and
\verb+\+\textit{name}\textit{false}.
The latter two set the \textit{name} condition to \textit{true} and
\textit{false}, respectively.
The \verb+\if+\textit{name} command tests the condition \textit{name}:
\begin{flushleft}
\verb+\if+\textit{name}\\
\ldots\textit{text$_1$}\\
\verb+\else+\\
\ldots\textit{text$_2$}\\
\verb+\fi+\\
\end{flushleft}
Text \textit{text$_1$} is processed when \textit{name} is
\textit{true}, otherwise \textit{text$_2$} is processed.
If \textit{text$_2$}  is empty, then the \verb+\else+ keyword can be
omitted.

Some conditions are defined internally by \hevea{}, such as the
\texttt{french} condition, which is \textit{true} in French mode, or
the \texttt{display} and \texttt{math} conditions that are set according
to \hevea{} current operating mode.
Another internal condition of interest is \texttt{optarg}, which is
set to true just after the parsing of arguments, when an optional
argument is indeed present.

\subsection{The \protect{\texttt{\char92{}verbatiminput}} Command}

The \verb+\verbatiminput+ command (cf. \cite[Page 66]{latexbis}) is
fully supported. Basically, this command typesets the content of a
file whose name is given as argument inside a \texttt{verbatim} environment.


\setcounter{section}{0}
\part{Practical information}
\label{practical}

\section{Usage}
\subsection{\hevea{} usage}\label{heveausage}

The \texttt{hevea} command interprets its arguments as the names of
\LaTeX{} source
files and attempts to process them.
If an argument \textit{filename} does not have an extension,
then a first attempt is made to open \textit{filename};
in case of failure, another attempt to open
\textit{filename}\texttt{.tex} is made.
In all cases, filenames that do not contain ``\texttt{/}'' are
searched along \texttt{hevea} search path.
\texttt{hevea} search path consist in the current, directory ``\texttt{.}'',
followed by directories specified by the user with the \texttt{-I}
option, and by \texttt{hevea} library directory
(normally \texttt{/usr/local/lib/hevea}). However,
\texttt{hevea} library directory compile-time value can be overridden by setting
the \texttt{HEVEADIR} shell environment variable.

If the last argument has extension \texttt{.tex}, that is, if
this last argument is \textit{name}\texttt{.tex}, then \textit{name} is
the input base name and output normally goes into file
\textit{name}\texttt{.html}.
Otherwise, there is no input base name, the standard input is read and
output normally goes to the standard output.
Please note that this operating mode is just for translating a few
constructs, the normal way to translate \textit{file}\verb+.tex+ being
``\verb+hevea+ \textit{file}\verb+.tex+'' and not
``\verb+hevea -o+ \textit{file}\verb+.html < + \textit{file}\verb+.tex+''

The \texttt{article.hva}, \texttt{seminar.hva}, \texttt{book.hva} and \texttt{report.hva}
base style files from \hevea{} library are special.
Only the first base style file is loaded and the
\verb+\documentclass+ command has no effect when a base style file is
already loaded. This feature allows to override a document base style
without editing it.


The \texttt{hevea} command recognizes the following options:
\begin{description}
\item[{\tt -v}] Verbose flag, can be repeated to increase
verbosity. However, this is mostly for debug.
\item[{\tt -s}] Suppress warnings.
\item[{\tt -e} {\it filename}] Prevent \texttt{hevea} from loading any file
whose name is \textit{filename}. Note that this option applies to all
files, including \texttt{hevea.hva} and style files.
\item[{\tt -idx}] Read the \textit{name}\texttt{.idx} file, where
\textit{name} is the input base name. This is useful when this
file is customized after it has been generated by \LaTeX{} (See,
sections~\ref{files} and~\ref{index}).
\item[{\tt -francais}] Set French mode.
This has three consequences:
\begin{itemize}
\item Some words inserted by \LaTeX{} (such as ``Chapter'',
``Bibliography'', \ldots) are replaced by French word.
\item Text replacement for symbols are  in French (see the
\texttt{-nosymb} option below).
\item \texttt{hevea} executes the \TeX{} conditional macro
\verb+\frenchtrue+.
\end{itemize}
\item[{\tt -nosymb}] Avoid symbol font.
In this mode, symbols are replaced by text-only equivalents. By
default, these equivalent are in English.
\item[{\tt -noiso}] Do not output (iso-latin1) characters whose code is above 127.
These characters are replaced by \html{} entities. This option is
mostly useful for generating \html{} that will be displayed properly
by \emph{Netscape Communicator} on a Macintosh.
\item[{\tt -I} {\it dirname}] Add {\it dirname} to the search path.
\item[{\tt -o} {\it filename}] Make \texttt{hevea} output go into file {\it
filename}. By default, \texttt{hevea} output goes into
\textit{name}\texttt{.html}, where \textit{name} is the input base name.
\item[{\tt -help}] Print version number and a short help message.
\end{description}

\hevea{} user manual is part~\ref{usermanual} of this document,
whereas \hevea{} reference manual is part~\ref{referencemanual} of
this document.


\subsection{\hacha{} usage}
The \texttt{hacha} command interprets its argument as the name of
a \html{} source file to cut into pieces.

It also recognizes the following options:
\begin{description}
\item[{\tt -v}] Be a little verbose.
\item[{\tt -o} {\it filename}] Make \hacha{} output go into file
\textit{filename} (defaults  to index.html).
\item[{\tt -help}] Print version number and a short help message.
\end{description}

\noindent Section~\ref{hacha} of the user manual explains how to
alter \hacha{} default behavior.

\subsection{\texttt{imagen} usage}\label{imagenusage}

\texttt{imagen} is a simple shell script that translates
a \LaTeX{} document into many \texttt{.gif} images.

It is a companion program of \hevea{}, which must have been previously run as:
\begin{flushleft}
\texttt{\# hevea}\ldots{} \textit{base}\texttt{.tex}\\
or\\
\texttt{\# hevea}\ldots{} \texttt{-o} \textit{base}\texttt{.html}\ldots\\
\end{flushleft}
Then, \textit{base} is \hevea{} base output name.
When told to do so (see section~\ref{imagen})
\hevea{} echoes part of its input into
the \textit{base}\texttt{.image.tex} file.

The \texttt{imagen} script should then be run as:
\begin{flushleft}
\texttt{\# imagen} \textit{base}
\end{flushleft}
The \texttt{imagen} script produces
one \textit{base}\textsl{nnn}\texttt{.gif} image file per page in the
\textit{base}\texttt{.image.tex} file.

This is done by first calling \texttt{latex} on
\textit{base}\texttt{.image.tex}, yielding one \texttt{dvi}
file.
Then, \texttt{dvips} translates this file into one single Postscript file that
contains all 
the images, or into one  Postscript file per image,
depending upon your version of \texttt{dvips}.
Postscript files are interpreted by \texttt{gs} that
outputs \texttt{ppm} images, which are then fed into a series of
transformations that change them into \texttt{.gif} files.

The \texttt{imagen} script recognizes the following options:
\begin{description}
\item[{\tt -mag} {\sl nnnn}] Change the enlarging ratio that is applied
while translating DVI into Postscript.
More precisely,  \texttt{dvips} is run with \texttt{-x}{\sl nnnn}
option.
Default value for this ration is $1414$, this means
that, by default, \texttt{imagen} magnifies \LaTeX{} output by a factor of
$1.414$.
\item[{\tt -extra} {\it command}] Insert {\it command} as an additional
stage in \texttt{imagen} \texttt{ppm} to \texttt{gif} production chain.
\textit{command} is an Unix filter that expects a \texttt{ppm} image
in its standard input and outputs a \texttt{ppm} image on its standard output.
A sensible choice for \textit{command} is one command from the
\texttt{netpbm} package or several such commands piped together.
\end{description}

These options enable users to correct some misbehaviors.
For instance, when the document base style is \textit{seminar}, image
orientation may
be wrong and the images are too small. This can be cured by invoking
\texttt{imagen} as:
\begin{flushleft}
\texttt{\# imagen -mag 2000 -extra "pnmflip -ccw"} \textit{base}
\end{flushleft}


More information on producing images can be found in section~\ref{imagen}.


\section{Browser configuration}\label{browser}
By default, \hevea{} insert non-standard font changes in its output,
using the \verb+FACE=symbol+ attribute to the \verb+<FONT>+ element.
The symbol font is the one available on the Linux Red Hat
distribution and seems to be present on many Unix installations.
A good way to know whether your browser can show \hevea{} symbols or
not is
comparing figure~\ref{xfd} and the web page located at
\localurl{symbol.html}.

\emph{Microsoft Explorer} displays the symbol font by default.

By default,  \emph{Netscape Communicator} does not display symbol fonts
as intended by \hevea{}.
On an Unix system, the following procedure instructs
\emph{Netscape Communicator} to do so:
\begin{itemize}
\item Add the following line to your \texttt{.Xdefaults} file:
\begin{verbatim}
Netscape*documentFonts.charset*adobe-fontspecific:   iso-8859-1
\end{verbatim}
\item Issue a \verb+xrdb .Xdefaults+ command.
\item Restart \emph{Netscape}.
\end{itemize}

On a Macintosh,
choose  {\bf Western (Mac Roman)} in the item {\bf Document~Encoding}
from the {\em Preferences} menu. This will work only if the document
does not contain iso-latin1 characters above 127. That is, this will
work only with documents that are generated by \hevea{} with the
\texttt{-noiso} option enabled (see section~\ref{heveausage}).


More details on browser configuration can be found at
\oneurl{http://www.tex2html.com/unix/}.
More details on symbol fonts can be found
in section~\ref{symbols} of this manual.
In particular, note that symbol fonts may be completely avoided with
the \verb+-nosymb+ option.

\section{Availability}

\subsection{Internet stuff}

\hevea{} home page is \oneurl{\httpbase}. It contains links to the
\footurl{\httpbase/doc/}{on-line manual}
and to the \footurl{\ftpbase}{distribution}.

The author can be contacted at \mailto{Luc.Maranget@inria.fr}.

\subsection{Law}
\hevea{} can be freely used and redistributed without modifications.
Modifying and redistributing \hevea{} requires a permission from INRIA.
See the \footurl{\ftpbase/LICENSE}{LICENSE} file for details.

\section{Installation}

\subsection{Requirements}\label{requirements}

The programs \commandname{hevea} and \commandname{hacha} are written in
\footurl{http://caml.inria.fr/ocaml/}{Objective Caml}. Thus, you
really need Objective Caml (version 2.00 or further) to compile them.
However, a Red~Hat 5.1
\footurl{\ftpbase/hevea-\heveaversion-1.i386.rpm}{binary distribution}
is also available, it does not require an Objective Caml installation
and can be installed on most Red~Hat Linux PC's.

\hevea{} extracts referencing information from \texttt{.aux} files,
and bibliographic information from \texttt{.bbl} files.
Hence, you need a fully functional \LaTeX{} system to get the right
cross reference labels in \hevea{} output.
Additionally, the \hevea{} user may instruct the program not to process a
part of the input (see section~\ref{imagen}). Instead, this part is
processed into a 
\verb+.gif+ file and \hevea{} outputs a  link to the image file.
\LaTeX{} source is changed into \verb+.gif+ images by the the \verb+imagen+
script, which basically calls, \LaTeX, \texttt{dvips},
\footurl{http://www.cs.wisc.edu/\home{ghost}/index.html}{\texttt{ghostscript}}
and a few tools from the image processing package
\footurl{ftp://wuarchive.wustl.edu/graphics/graphics/packages/NetPBM}{\texttt{netpbm}}.

To benefit from the full functionality of \hevea, you need all
this software. However, \hevea{} runs without them, but then you will
have to accept ``X'' labels and to manage to produce images by yourself.

\subsection{Principles}
The details are given in the \url{\ftpbase/README}{\texttt{README}}
file from the distribution.
Basically, \hevea{} should be given a library
directory. The installation procedure stores the \texttt{hevea.hva}
and base style files in this directory.
There are two compilation mode, the \texttt{opt} mode selects the
native code  Ocaml compiler \texttt{ocamlopt}, while the \texttt{byte}
mode selects the bytecode  Ocaml compiler \texttt{ocamlc}.
In \hevea{} case, \texttt{ocamlopt} produces code that is up to three
times as fast as the one produced by \texttt{ocamlc}.
Thus, default compilation mode is \texttt{opt}, however it may be the
case on some systems that only \texttt{ocamlc} is available.

Note that the \texttt{hevea.sty} file is simply copied to \hevea{}
library directory. It remains users responsibility to
make it accessible to \LaTeX.

\section{Other \LaTeX{} to \html{} translators}
This short section gives pointers to a few other translators. I
performed not extensive testing and make no thorough comparison.
\begin{description}
\item[LaTeX2html]
LaTeX2html is a full system. It is written in perl and
calls \LaTeX{} when in trouble.
As a consequence, LaTeX2html is powerful but it may fail on
large documents, for speed and memory reasons.
More information on LaTeX2html can be found at
\begin{center}
\oneurl{http://www-dsed.llnl.gov/files/programs/unix/latex2html/}
\end{center}

\item[TTH] The principle behind TTH is the same as the one of
\hevea{}: write a fast translator as a lexer, use symbol fonts and
tables. However, there are differences, TTH accepts both \TeX{} and
\LaTeX{} source, 
TTH is written in C and the full source is not available
(only \verb+lex+ output is available).
Additionally, TTH  insist on not using any kind of \LaTeX{}
generated information and will show proper cross-reference labels,
even when no \texttt{.aux} file is present.
TTH output is a single document,
whereas \hacha{} can cut the output of \hevea{} into several files.
(however there exists a commercial
version of TTH that provides this extra functionality).
TTH can be found at
\begin{center}
\oneurl{http://hutchinson.belmont.ma.us/tth/tth.html}.
\end{center}

\item[\texttt{htmlgen}] The \texttt{htmlgen} translator is specialized
for producing the Caml manuals. This is \hevea{} direct ancestor and I
owe much to its author, X.~Leroy. See \cite{htmlgen} for a description
of \texttt{htmlgen} and a (bit outdated) discussion on \LaTeX{} to
\html{} translation.
\end{description}

A fairly complete list of \LaTeX{} to \html{} translators can be found
at:
\begin{center}
\oneurl{http://www.loria.fr/services/tex/english/outils.html}
\end{center}

\begin{thebibliography}{xxxxxxxxxx}
\bibitem[\LaTeX-bis]{latexbis}
M.~Gooseens, F.~Mittelbach, A.~Samarin.
\newblock {\em The \LaTeX{} Companion}
\newblock Addison-Websley, 1994.
\bibitem[\LaTeX]{latex}
L. Lamport.
\newblock {\em A Document Preparation System System, \LaTeX{}, User's
Guide and Reference Manual}.
\newblock Addison-Websley, 1994.
\bibitem[htmlgen]{htmlgen}
X. Leroy,
\newblock {\em Lessons learned from the translation of documentation
from \LaTeX{} to {\html}}.
\newblock ERCIM/W4G Int. Workshop on WWW Authoring and Integration
Tools, 1995.
\newblock Available on the web at
\oneurl{http://cristal.inria.fr/\home{xleroy}/w4g.html}

\bibitem[HTML]{html}
D.~Ragget.
{\em HTML 3.2 Reference Specification}. Available on the web at
\oneurl{http://www.w3.org/TR/REC-html32}, 1997.
\end{thebibliography}
\end{document}
